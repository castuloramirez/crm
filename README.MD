![输入图片说明](https://gitee.com/uploads/images/2018/0605/143735_07fd05d1_460571.jpeg "jboss (1).jpg")

#### Contact Rockwell Automation

#### 联系罗克韦尔自动化

Customer Support Telephone — 1.440.646.3434
Online Support — http://support.rockwellautomation.com

客户支持电话 - 1.440.646.3434在线支持 - [http://support.rockwellautomation.com](http://support.rockwellautomation.com/)


#### Copyright Notice

#### 版权声明

© 2017 Rockwell Automation Technologies, Inc. All rights reserved. Printed in USA.
This document and any accompanying Rockwell Software products are copyrighted by Rockwell Automation Technologies, Inc. Any reproduction and/or distribution without prior written consent from Rockwell Automation Technologies, Inc. is strictly prohibited. Please refer to the license agreement for details.

©2017罗克韦尔自动化技术有限公司版权所有。美国印刷。本文档及随附的罗克韦尔软件产品均受罗克韦尔自动化技术有限公司的版权保护。未经罗克韦尔自动化技术有限公司事先书面许可，严禁进行任何复制和/或分发。详情请参阅许可协议。

#### Trademark Notices

#### 商标声明

FactoryTalk, Rockwell Automation, Rockwell Software, FactoryTalk View, and the Rockwell Software logo are registered trademarks of Rockwell Automation, Inc.

FactoryTalk，罗克韦尔自动化，罗克韦尔软件，FactoryTalk View和Rockwell Software徽标是罗克韦尔自动化有限公司的注册商标。

The following logos and products are trademarks of Rockwell Automation, Inc.:

以下徽标和产品是罗克韦尔自动化公司的商标：

FactoryTalk Shop Operations Server, FactoryTalk ProductionCentre, FactoryTalk View, FactoryTalk Administration Console, FactoryTalk Services Platform, FactoryTalk Live Data, RSAssetSecurity,  FactoryTalk Security, FTPC Administrator, Integrate, Operational Data Store, ODS, Plant Operations, Process Designer,  Live Transfer, Rockwell Software CPGSuite,  Rockwell Software PharmaSuite, and Rockwell Software AutoSuite.

FactoryTalk Shop Operations服务器，FactoryTalk ProductionCentre，FactoryTalk View，FactoryTalk管理控制台，FactoryTalk服务平台，FactoryTalk Live数据，RSAssetSecurity，FactoryTalk Security，FTPC管理员，集成，操作数据存储，ODS，工厂操作，流程设计器，实时传输， CPGSuite，Rockwell Software PharmaSuite和Rockwell Software AutoSuite。

#### Other Trademarks

#### 其他商标

ActiveX, Microsoft, Microsoft Access, SQL Server, Visual Basic, Visual C++, Visual SourceSafe, Windows, Windows ME, Windows NT, Windows 2000, Windows Server 2003, Windows Server 2008, and Windows Server 2012 are either registered trademarks or trademarks of Microsoft Corporation in the United States and/or other countries.

的ActiveX，微软的Microsoft Access，SQL服务器，Visual Basic中的Visual C ++，Visual SourceSafe中，Windows时，Windows ME，视窗NT，Windows 2000，Windows Server 2003中，在Windows Server 2008和Windows Server 2012是注册微软的商标或商标。公司在美国和/或其他国家。

Adobe, Acrobat, and Reader are either registered trademarks or trademarks of Adobe Systems Incorporated in the United States and/or other countries.

Adobe，Acrobat和Reader是Adobe Systems Incorporated在美国和/或其他国家的注册商标或商标。

ControlNet is a registered trademark of ControlNet International.
DeviceNet is a trademark of the Open DeviceNet Vendor Association, Inc. (ODVA).

ControlNet是ControlNet International的注册商标。DeviceNet是Open DeviceNet Vendor Association，Inc.（ODVA）的商标。

Ethernet is a registered trademark of Digital Equipment Corporation, Intel, and Xerox Corporation.

以太网是Digital Equipment Corporation，Intel和Xerox Corporation的注册商标。

OLE for Process Control (OPC) is a registered trademark of the OPC Foundation.

用于过程控制的OLE（OPC）是OPC基金会的注册商标。

Oracle, SQL*Net, and SQL*Plus are registered trademarks of Oracle Corporation.

Oracle，SQL Net和SQL Plus是Oracle Corporation的注册商标。

All other trademarks are the property of their respective holders and are hereby acknowledged.

所有其他商标均为其各自所有者的财产，特此声明。

#### Warranty

#### 保证

This product is warranted in accordance with the product license. The product’s performance may be affected by system configuration, the application being performed, operator control, maintenance, and other related factors.   Rockwell Automation is not responsible for these intervening factors. The instructions in this document do not cover all the details or variations in the equipment, procedure, or process described, nor do they provide directions for meeting every possible contingency during installation, operation, or maintenance. This product’s implementation may vary among users.

本产品根据产品许可证进行担保。产品的性能可能受到系统配置，正在执行的应用程序，操作员控制，维护和其他相关因素的影响。罗克韦尔自动化对这些干预因素不承担任何责任。本文档中的说明并未涵盖所描述的设备，程序或过程的所有细节或变化，也未提供满足安装，操作或维护过程中可能出现的任何意外情况的说明。该产品的实施可能因用户而异。

This document is current as of the time of release of the product; however, the accompanying software may have changed since the release. Rockwell Automation, Inc. reserves the right to change any information contained in this document or the software at anytime without prior notice. It is your responsibility to obtain the most current information available from Rockwell when installing or using this product.

本文档在产品发布时是最新的; 但是，自发布以来，随附的软件可能已更改。罗克韦尔自动化有限公司保留随时更改本文档或软件中包含的任何信息的权利，恕不另行通知。您有责任在安装或使用本产品时获取罗克韦尔提供的最新信息。

# Table of Contents
# 目录

#### Read Me First....................................................................5

#### 先读我............................................... ..................... 5

Audience and Expectations...........................................................6

观众和期望............................................... ............ 6

Organization..................................................................................6

组织................................................. ................................. 6

Other Information Sources............................................................7

其他信息来源............................................... ............. 7

Product Installation Documentation Set..................................7

产品安装文档集................................. 7

Related Documentation............................................................7

相关文件................................................ ............ 7

Solutions and Technical Support..............................................8

解决方案和技术支持.............................................. 8

Types of User Logins....................................................................8

用户登录类型.............................................. ...................... 8

#### Chapter 1 Installation Overview and Checklists............................. 9

#### 第1章安装概述和清单..................................... 9

New FTPC Installation Checklist............................................... 11

新的FTPC安装清单.............................................. 11

Upgrade FTPC Installation Checklist.........................................11

升级FTPC安装清单......................................... 11

#### Chapter 2 Operating System Products.......................................... 13

#### 第2章操作系统产品.......................................... 13

Install Windows..........................................................................14

安装Windows ................................................ .......................... 14

Verify Operating System Language Support..............................14

验证操作系统语言支持.............................. 14

Verify Network Connections.......................................................15

验证网络连接............................................... ........ 15

Install the Web Browser..............................................................15

安装Web浏览器.............................................. ................ 15

Configure the Java JNLP Setting................................................15

配置Java JNLP设置............................................. ... 15

#### Chapter 3 Install FTPC Stand-Alone.............................................. 17

#### 第3章独立安装FTPC ........................................... ... 17

Stop Other Applications..............................................................18

停止其他应用............................................... ............... 18

Run the FTPC Installer...............................................................18

运行FTPC安装程序.............................................. ................. 18

Verify the standalone.conf.bat File.............................................25

验证standalone.conf.bat文件.......................................... ... 25

Configure Default Tab Behavior (Optional)...............................26

配置默认选项卡行为（可选）............................... 26

Launch the Applications.............................................................27

启动应用程序............................................... .............. 27

#### Chapter 4 Configure the Database Connections.......................... 31

#### 第4章配置数据库连接........................... 31

Configure and Deploy the Datasources......................................32

配置和部署数据源........................................ 32

Register the Databases................................................................34

注册数据库............................................... ................. 34

Initialize the Databases...............................................................35

初始化数据库............................................... ................ 35

Define JMS Connection Information..........................................36

定义JMS连接信息.......................................... 36

Disable the Ability to Delete or Rename Users (Optional)........37

禁用删除或重命名用户的权限（可选）........ 37

####  Chapter 5 Upgrading FTPC............................................................. 39

####  第5章升级FTPC .............................................. ............... 39

Pre-upgrade Preparation.............................................................40

升级前准备.............................................. ............... 40

Disconnect All Clients...........................................................40

断开所有客户端............................................... ............ 40

Unlock JRE............................................................................40

解锁JRE ................................................ ............................ 40

Back Up the FTPC Databases................................................40

备份FTPC数据库............................................. ... 40

Uninstall the FTPC Applications...........................................40

卸载FTPC应用程序........................................... 40

Upgrade FTPC From a Previous Build.......................................42

从以前的版本升级FTPC ....................................... 42

Additional Upgrade Activities....................................................43

额外升级活动............................................... ..... 43

Oracle................................................................................43

甲骨文................................................. ............................... 43

SQL Server........................................................................44

SQL Server ................................................ ........................ 44

Migrate the Databases............................................................44

迁移数据库............................................... ............. 44

Upgrade the Message Pack....................................................45

升级消息包.............................................. ...... 45

####  Appendix A Using the Shop Operations HMI Client........................ 47

附录A使用Shop Operations HMI客户端........................ 47

Audience and Expectations.........................................................48

观众和期望............................................... .......... 48

Install the Shop Operations HMI Client.....................................48

安装Shop Operations HMI客户端....................................... 48

Set Java Runtime Properties..................................................50

设置Java运行时属性.............................................. .... 50

Add the Shop Operations HMI Client to an HMI Display.........51

将车间操作HMI客户端添加到HMI显示器......... 51 

Visual Basic API.........................................................................53

Visual Basic API ........................... .............................................. 53

Return Codes for the API............................................................54

API的返回码............................................. ............... 54

Uninstall the Shop Operations HMI Client................................55

卸载Shop Operations HMI客户端................................ 55

Upgrade the Shop Operations HMI Client.................................55

升级Shop Operations HMI Client ................................. 55

####  Appendix B Shop Operations Server................................................ 57

####  附录B商店运营服务器............................................. ... 57

Prerequisites................................................................................59

先决条件................................................. ............................... 59

Downloading Shop Operations Server.......................................59

下载Shop Operations Server ....................................... 59

Installing Shop Operations Server..............................................60

安装Shop Operations Server .............................................. 60

Installing as a Windows Administrator..................................60

作为Windows管理员安装.................................. 60

Installing as an Administrator User Group Member..............63

以管理员身份安装用户组成员.............. 63

Modifying the Startup Delay Interval (Optional).......................63

修改启动延迟时间间隔（可选）....................... 63

Configure the Function Thread Pool Size (Optional).................64

配置函数线程池大小（可选）................. 64

Run Shop Operations Server.......................................................64

运行Shop Operations Server .............................................. ......... 64

Administering Shop Operations Server......................................66

管理Shop Operations Server ........................................ 66

Configuring the Server...........................................................67

配置服务器............................................... ............ 67

Configuring the User..............................................................68

配置用户............................................... ............... 68

Configuring Logging..............................................................69

配置日志................................................ .............. 69

Using Event Sheets.....................................................................70

使用事件表............................................... ...................... 70

Run an Event Sheet................................................................72

运行活动表.............................................. .................. 72

Monitor the Event Sheet........................................................72

监视事件表.............................................. .......... 72

View Event Status.............................................................73

查看活动状态............................................... .............. 73

View Event History...........................................................75

查看活动历史............................................... ............ 75

View Event Chart..............................................................75

查看活动图表............................................... ............... 75

Viewing Logs..............................................................................78

查看日志................................................ .............................. 78

Viewing Error/Information Logs............................................78

查看错误/信息日志............................................ 78

Logging Debug Messages......................................................80

记录调试消息............................................... 80

Viewing Println Output..........................................................80

查看Println输出............................................... ........... 80

Viewing Application Logs......................................................81

查看应用程序日志............................................... ....... 81

Configuring Failover...................................................................84

配置故障转移................................................ ................... 84

Limitations.............................................................................88

限制................................................. ............................ 88

Uninstalling Shop Operations Server..........................................88

卸载Shop Operations Server .......................................... 88

Upgrading Shop Operations Server............................................88

升级店铺运营服务器................................................ 88

####  Appendix C Troubleshooting............................................................. 89

####  附录C故障排除............................................... .............. 89

Viewing Available Log Files.......................................................90

查看可用的日志文件.............................................. ......... 90

Server-Side Log Files.............................................................90

服务器端日志文件............................................. ................ 90

Client-Side Log Files.............................................................91

客户端日志文件............................................. ................ 91

Consolidated Log...................................................................91

合并日志................................................ ................... 91

Application Log.....................................................................92

应用程序日志................................................ ..................... 92

Running FTPC Through a Proxy Server.....................................94

通过代理服务器运行FTPC ..................................... 94

Running Java after Upgrading....................................................95

升级后运行Java .............................................. ...... 95

#### Index.................................................................................97

指数................................................. ................................ 97

# Read Me First
# 首先阅读我

#### In this chapter

#### 在这一章当中

- `Audience and Expectations`    6

- `Organization`    6

- `Other Information Sources`

  - 7 Product Installation Documentation Set

  - 7产品安装文档集

  - 7 Related Documentation

  - 7相关文档

  - 7 Solutions and Technical Support    8

  - 7解决方案和技术支持8

- `Types of User Logins`    8

## Audience and Expectations

## 观众和期望

This book is intended for experienced professionals who understand their company’s business needs, the technical terms used, and software dependencies described in this guide. We expect the user to be experienced with administering the following applications and technologies:

本书面向那些了解其公司业务需求，使用的技术术语以及本指南中描述的软件相关性的经验丰富的专业人员。我们期望用户在管理以下应用程序和技术方面有丰富的经验：

- Operating systems

- 操作系统

- Web server environments

- Web服务器环境

- Application server environments

- 应用服务器环境

> IMPORTANT:
> 重要提示：
> If you plan on using this stand-alone installation in a production environment, you must purchase the licenses for JBoss through Red Hat directly.
> 如果您打算在生产环境中使用此独立安装，则必须直接通过Red Hat购买JBoss的许可证。

This guide covers FactoryTalk® ProductionCentre (called FTPC hereafter) installation using the stand-alone installer for JBoss, but it assumes that the supporting network equipment and software are or can be installed. This document does not provide installation instructions for related components, like Internet connections, but it does describe configuration settings required to run this software. It assumes that you have already installed the database server and created Production and ODS databases. For more information about setting up your database, please refer to the FactoryTalk ProductionCentre Database Installation Guide. To set up an FTPC server on JBoss for a non-default or clustered environment, refer to the FactoryTalk ProductionCentre Server Installer Guide - JBoss Advanced.

本指南涵盖了使用JBoss独立安装程序安装的FactoryTalk®ProductionCentre（以下称为FTPC）安装程序，但它假定支持的网络设备和软件已安装或可以安装。本文档不提供相关组件（如Internet连接）的安装说明，但它描述了运行此软件所需的配置设置。它假定您已经安装了数据库服务器并创建了生产和ODS数据库。有关设置数据库的更多信息，请参阅“FactoryTalk ProductionCentre数据库安装指南”。要在JBoss上为非默认或集群环境设置FTPC服务器，请参考FactoryTalk ProductionCentre服务器安装程序指南 - JBoss Advanced。

> IMPORTANT:
> 重要提示：
> You cannot migrate from a JBoss stand-alone installation to a JBoss advanced installation. To go from stand-alone to advanced, you must first completely uninstall the JBoss stand-alone installation and then install the JBoss advanced installer from scratch.
> 您不能从JBoss独立安装迁移到JBoss高级安装。要从独立到高级，您必须先完全卸载JBoss独立安装，然后从头开始安装JBoss高级安装程序。

## Organization
## 组织

This book contains the following chapters and appendices:

本书包含以下章节和附录：

- `Chapter 1, “Installation Overview and Checklists”` - Provides checklists for installing FTPC in the JBoss environment.

- `Chapter 1, “Installation Overview and Checklists”` - 提供在JBoss环境中安装FTPC的清单。

- `Chapter 2, “Operating System Products”` - Describes the installation and configuration of the supported operating systems.

- `Chapter 2, “Operating System Products”` - 介绍所支持的操作系统的安装和配置。

- `Chapter 3, “Install FTPC Stand-Alone”`- Provides instructions for installing and configuring FTPC.

- `Chapter 3, “Install FTPC Stand-Alone”` - 提供安装和配置FTPC的说明。

- `Chapter 4, “Configure the Database Connections”` - Provides instructions for configuring and initializing the database through FTPC Administrator.

- `Chapter 4, “Configure the Database Connections”` - 提供有关通过FTPC管理员配置和初始化数据库的说明。

- `Chapter 5, “Upgrading FTPC”` - Provides instructions for upgrading FTPC.

- `Chapter 5, “Upgrading FTPC”` - 提供升级FTPC的说明。

- `Appendix A, “Using the Shop Operations HMI Client”`- Provides instructions for downloading and using the Shop Operations HMI Client on a FactoryTalk View display.

- `Appendix A, “Using the Shop Operations HMI Client”` - 提供在FactoryTalk View显示屏上下载和使用Shop Operations HMI Client的说明。

- `Appendix B, “Shop Operations Server”` - Provides instructions for installing and monitoring Shop Operations Server through the administration console.

- `Appendix B, “Shop Operations Server”` - 提供通过管理控制台安装和监控Shop Operations Server的说明。

## Other Information Sources

## 其他信息来源

In addition to this guide, you should review the following books, articles, and help topics.

除了本指南外，您还应阅读以下书籍，文章和帮助主题。

#### Product Installation Documentation Set

#### 产品安装文档集

This installation guide was designed to be used with the following guides, available at the FTPC software download web site:

本安装指南旨在与以下指南配合使用，可在FTPC软件下载网站上获取：

- `FactoryTalk ProductionCentre Supported Platforms Guide` for a list of supported hardware and software.

- `FactoryTalk ProductionCentre Supported Platforms Guide` 获取支持的硬件和软件列表。

- `FactoryTalk ProductionCentre Database Installation Guide` for instructions on installing and configuring the database.

- `FactoryTalk ProductionCentre Database Installation Guide` 有关安装和配置数据库的说明。

## Related Documentation

## 相关文档

The following table lists other available documents that are related to FTPC installation and upgrades.

下表列出了与FTPC安装和升级相关的其他可用文档。

Topic<br>话题 | Title<br>标题 | Location<br>位置
-|-|-|
Required third party software installation and configuration<br>所需的第三方软件安装和配置 | Third party software documentation, such as Installing SQL Server or Getting Started with JBoss.<br>第三方软件文档，例如安装SQL Server或JBoss入门。 | JBoss, or Microsoft web site or manual<br>JBoss或Microsoft网站或手册
Installation issues such as: <br>安装问题，例如：<br> - General installation and patches<br>- 常规安装和修补程序 <br>- Performance<br>- 性能 <br>- Security<br>- 安全性 | Keyword:<br>关键字： <br>- Install<br>- 安装 <br>- Performance<br>- 性能 <br>- Security<br>- 安全性 | FTPC online knowledge base<br>FTPC在线知识库

#### Solutions and Technical Support

#### 解决方案和技术支持

To access FTPC online knowledge base articles, contact Technical Support at (440) 646-3434.

要访问FTPC在线知识库文章，请拨打（440）646-3434联系技术支持。

## Types of User Logins

## 用户登录类型

FTPC installations require four types of user logins.

FTPC安装需要四种类型的用户登录。

- `Installation (or Operating System) Login` allows the user to install and configure the operating system, JBoss Application Server, and FTPC. The user must be added to the Administrator group on the machine where you will install JBoss and FTPC.

- `Installation (or Operating System) Login`允许用户安装和配置操作系统，JBoss Application Server和FTPC。必须将用户添加到要安装JBoss和FTPC的计算机上的管理员组。

- `Database User` configures the databases. You must create a Database User with the minimum database privileges. See the FactoryTalk ProductionCentre Database Installation Guide for information about creating database logins.

- `Database User`配置数据库。您必须创建具有最低数据库权限的数据库用户。有关创建数据库登录的信息，请参见“FactoryTalk ProductionCentre数据库安装指南”。

- `FTPC Administrator Login` allows the user to connect to, initialize, and migrate databases. Currently, the default user name/password used for logging into FTPC Administrator is admin/admin. You can change the password in FTPC Administrator, but you cannot change the user name.

- `FTPC Administrator Login`允许用户连接，初始化和迁移数据库。目前，用于登录FTPC管理员的默认用户名/密码是admin / admin。您可以在FTPC Administrator中更改密码，但不能更改用户名。

- `FTPC User Login` is needed with the FTPC Custom Security Provider and allows the user to access the FTPC application through a web browser. A default administrative user is created during installation. The default user name/password is admin/admin. Additional administrative uses are created in Process Designer by a user with the Administrator privileges who is using the FTPC Custom Security Provider. If you are using another security model, you must create the user according to those requirements.

- `FTPC User Login`是FTPC自定义安全提供程序所必需的，并允许用户通过Web浏览器访问FTPC应用程序。安装期间会创建一个默认的管理用户。默认的用户名/密码是admin / admin。其他管理用途由具有使用FTPC自定义安全提供程序的管理员权限的用户在Process Designer中创建。如果您正在使用其他安全模式，则必须根据这些要求创建用户。

> NOTE:
> 注意：
> The default user name/password used for logging into FTPC Administrator is not the same default administrative user is created during FTPC installation.
> 用于登录到FTPC Administrator的默认用户名/密码与FTPC安装期间创建的默认管理用户不同。

# Chapter 1

# 第1章

# Installation Overview and Checklists

# 安装概述和清单

#### In this chapter

#### 在这一章当中

- New FTPC Installation Checklist    11

- 新的FTPC安装清单11

- Upgrade FTPC Installation Checklist    11

- 升级FTPC安装清单11

The stand-alone installer is intended to be used to build systems that do not have the performance or platform requirements that a clustered system might and can only be used on a supported version of the Windows operating system. See the `FactoryTalk ProductionCentre Supported Platforms Guide` for more information about the supported versions. The FTPC stand-alone installer automatically installs and configures the following products:

独立安装程序旨在用于构建系统，这些系统不具有集群系统可能并且只能在支持的Windows操作系统版本上使用的性能或平台要求。请参阅`FactoryTalk ProductionCentre Supported Platforms Guide`有关受支持版本的更多信息。FTPC独立安装程序会自动安装和配置以下产品：

- JBoss Application Server and the JBoss MQ messaging service

JBoss应用服务器和JBoss MQ消息服务

- Apache Tomcat

- Apache Tomcat

- Java™ 2 SDK

- Java™2 ​​SDK

- Microsoft SQL Server Driver for JDBC

用于JDBC的Microsoft SQL Server驱动程序

- FTPC EAR files

- FTPC EAR文件

The stand-alone installer builds an FTPC application server system with the following configuration. If you need to configure a system that is different from this, use the FTPC Advanced Installer for JBoss and the respective installation guide.

独立安装程序使用以下配置构建FTPC应用程序服务器系统。如果您需要配置与此不同的系统，请使用JBoss的FTPC高级安装程序和相应的安装指南。

- `JBoss Application Server`: FTPC must run under JBoss. In addition to installing JBoss Application Server, the stand-alone installer deploys all FTPC EAR files to the `C:\Rockwell\PO<version>.<build>` directory.

- `JBoss Application Server`：FTPC必须在JBoss下运行。除了安装JBoss Application Server之外，独立安装程序还会将所有FTPC EAR文件部署到该`C:\Rockwell\PO<version>.<build>`目录。

- `FTPC Application Security`: The FTPC application server must use the FTPC Custom Security Provider to authenticate users.

- `FTPC Application Security`：FTPC应用程序服务器必须使用FTPC自定义安全提供程序对用户进行身份验证。

- `Single-Server`: You cannot use the stand-alone installer to install FTPC in a configuration that uses load-balancing or failover.

- `Single-Server`：您无法使用独立安装程序将FTPC安装到使用负载平衡或故障转移的配置中。

- `JDBC Drivers`: The stand-alone installer automatically installs and references the MSSQL Server JDBC drivers in FTPC.

- `JDBC Drivers`：独立安装程序自动安装并引用FTPC中的MSSQL Server JDBC驱动程序。

- `Tomcat Servlet Engine`: The stand-alone installer automatically installs the Tomcat Servlet Engine.

- `Tomcat Servlet Engine`：独立安装程序会自动安装Tomcat Servlet Engine。

- `Network Ports`: The stand-alone installer automatically configures the network ports. The stand-alone installer does not support changing the listener ports for any component being installed.

- `Network Ports`：独立安装程序自动配置网络端口。独立安装程序不支持更改正在安装的任何组件的侦听器端口

  - Configures the HTTP listener port for FTPC Home to 8080.

  - 将FTPC Home的HTTP侦听器端口配置为8080。

  - Configures the Tomcat listener port to 8081.

  - 将Tomcat侦听器端口配置为8081

- Windows Services: after completing this instructions, the following Windows Services will be created:

- Windows服务：完成本说明后，将创建以下Windows服务：

  - Apache Tomcat: runs the Tomcat Server as a service.

  - Apache Tomcat：作为服务运行Tomcat服务器

  - JBoss[EAP]`<version>`GA: runs the JBoss Application Server as a service.

  - JBoss [EAP] <version>GA：作为服务运行JBoss应用程序服务器。

#### New FTPC Installation Checklist The FTPC Server Checklist

#### 新的FTPC安装清单FTPC服务器清单

describes the procedure for installing and configuring the software required to set up a stand-alone server system.

介绍了安装和配置设置独立服务器系统所需软件的步骤。

##### Table 1-1 FTPC Server Checklist in a New Environment

##### 表1-1新环境中的FTPC服务器清单

Done? | Step | Page
-|-|-
1. |Review software and hardware requirements in the FactoryTalk ProductionCentre Supported Platforms Guide to verify you have the supported versions and sufficient hardware. Find this guide at the FTPC software download web site.<br>查看“FactoryTalk ProductionCentre支持的平台指南”中的软件和硬件要求，以验证您是否拥有支持的版本和足够的硬件。在FTPC软件下载网站上查找本指南 |空|
2. |Make sure the database server software is installed and the required databases have been created and configured. Refer to the FactoryTalk ProductionCentre Database Installation Guide for instructions.<br>确保安装了数据库服务器软件，并且已经创建和配置了所需的数据库。有关说明，请参阅FactoryTalk ProductionCentre数据库安装指南。 | 空|
3. | Review “Types of User Logins” and verify that you have sufficient permissions and privileges.<br>查看“用户登录类型”并确认您拥有足够的权限和特权。 | page 8<br>第8页
4. | “Install Windows”<br>“安装Windows” | page 14<br>第14页 |
5. | “Verify Operating System Language Support”b<br>“验证操作系统语言支持”b | page 14<br>第14页
6. | “Verify Network Connections”<br>“验证网络连接” | page 15<br>第15页
7. | “Install the Web Browser”<br>“安装Web浏览器” | page 15<br>第15页
8. | “Stop Other Applications” using install ports<br>使用安装端口“停止其他应用程序” | page 18<br>第18页
9. | “Install FTPC Stand-Alone”<br>“安装FTPC独立” | page 17
空 | aFAT file system is not supported. bIf using FTPC message object, verify the operating system provides language support.<br>aFAT文件系统不受支持。b如果使用FTPC消息对象，请验证操作系统是否提供语言支持| 空 |

#### Upgrade FTPC Installation Checklist

#### 升级FTPC安装清单

The stand-alone FTPC installation checklist describes the procedure for upgrading and configuring the software required to set up an application server that will serve a stand-alone system.

独立的FTPC安装清单介绍了升级和配置设置将用于独立系统的应用程序服务器所需的软件的过程。

##### Table 1-2 FTPC Server Checklist - Upgrade

##### 表1-2 FTPC服务器清单 - 升级

Done<br>完成| Step<br>步 | Page<br>页
-|-|-
1. | Review software and hardware requirements in the FactoryTalk ProductionCentre Supported Platforms Guide to verify you have the supported versions and sufficient hardware. Find this guide at the FTPC software download web site.<br>查看“FactoryTalk ProductionCentre支持的平台指南”中的软件和硬件要求，以验证您是否拥有支持的版本和足够的硬件。在FTPC软件下载网站上查找本指南 | 空 |
2. | Upgrade required third-party software. <br><升级所需的第三方软件。>| 空 |
3. | “Pre-upgrade Preparation”<br>“升级前准备” | page 40<br>第40页
4. | “Upgrading FTPC” page 39 5. “Install FTPC Stand-Alone”<br>“升级FTPC”第39页5.“安装FTPC” | page 17<br>第17页
6. | “Upgrade FTPC From a Previous Build”<br>“从以前的版本升级FTPC” | page 42<br>第42页
7. | “Additional Upgrade Activities”<br>“其他升级活动” | page 43<br>第43页


# Chapter 2

# 第2章

# Operating System Products

# 操作系统产品

#### In this chapter:

#### 在这一章当中：

- `Install Windows    14`
- `Verify Operating System Language Support    14`
- `Verify Network Connections    15`
- `Install the Web Browser    15`
- `Configure the Java JNLP Setting    15`

The following sections provide information on the Windows installation and configuration.

以下部分提供有关Windows安装和配置的信息。

## Install Windows

## 安装Windows

See the `FTPC Supported Platforms Guide` for a list of specific Windows, Windows Server, and Windows service pack versions supported on the FTPC application server and clients.

请参阅以`FTPC Supported Platforms Guide`获取FTPC应用程序服务器和客户端支持的特定Windows，Windows Server和Windows Service Pack版本的列表。

> IMPORTANT:
> 重要：
> If installing FTPC on a client machine running Windows 10, you must install FTPC as an administrator (right-click the installer > Run as administrator).
> 如果在运行Windows 10的客户机上安装FTPC，则必须以管理员身份安装FTPC（右键单击安装程序>以管理员身份运行）。

#### Figure 2-1:    Install as Administrative User
#### 图2-1：以管理用户身份安装
![Figure 2-1:    Install as Administrative User](https://gitee.com/uploads/images/2018/0605/143747_eee81fe8_460571.jpeg "jboss (2).jpg")

> NOTE:
> 注意：
> If you will be launching FTPC applications (i.e., Process Designer or Shop Operations) using Java Web Start, make sure your client machine has a Java version higher than 1.5 installed and that the JAVA_HOME environment variable is defined.
> 如果您要使用Java Web Start启动FTPC应用程序（即Process Designer或Shop Operations），请确保您的客户端机器安装的Java版本高于1.5，并且定义了JAVA_HOME环境变量。

For application server installations, the NTFS file system must be used. Client machines can use any file system.

对于应用程序服务器安装，必须使用NTFS文件系统。客户机可以使用任何文件系统

If JBoss and FTPC will be installed on a new machine, then a Windows administrator should follow the Microsoft documentation to install the operating system. The default installation selections support FTPC.

如果JBoss和FTPC安装在新机器上，那么Windows管理员应该遵循Microsoft文档来安装操作系统。默认的安装选择支持FTPC。

#### Verify Operating System Language Support

#### 验证操作系统语言支持

If you are planning to use the Process Designer Message object to localize your applications, the operating system on the FTPC Application Server system and clients must support the locale being used. Verify that you have the operating system support for the languages defined in the message object.

如果您打算使用Process Designer消息对象来本地化应用程序，则FTPC应用程序服务器系统上的操作系统和客户端必须支持正在使用的区域设置。验证您是否拥有对消息对象中定义的语言的操作系统支持。

The operating system Regional Options on the client must be one of the locales defined in the Message object. After installing FTPC, see the Process Designer Online Help for more information about setting your locale and display language.

客户端上的操作系统区域选项必须是Message对象中定义的语言环境之一。安装FTPC之后，请参阅Process Designer联机帮助以获取有关设置语言环境和显示语言的更多信息。

#### Verify Network Connections

#### 验证网络连接

The FTPC Application Server systems and all FTPC clients must be connected over the network using TCP/IP. See the operating system documentation for information about network setup and configuration.

FTPC应用程序服务器系统和所有FTPC客户端必须使用TCP / IP通过网络连接。有关网络设置和配置的信息，请参阅操作系统文档。

#### Install the Web Browser FTPC

#### 安装Web浏览器FTPC

supports Internet Explorer, Google Chrome and Edge on Windows 10. For more information about the exact versions that FTPC supports, please review the `FactoryTalk ProductionCentre Supported Platforms Guide`.

支持Windows 10上的Internet Explorer，Google Chrome和Edge。有关FTPC支持的确切版本的更多信息，请查看`FactoryTalk ProductionCentre Supported Platforms Guide`。

> TIP:
> 提示：
> From the Java Control Panel, you can enable Java content for your browser and configure security levels.
> 在Java控制面板中，您可以为浏览器启用Java内容并配置安全级别。

#### Configure the Java JNLP Setting
#### 配置Java JNLP设置

In order to launch the FTPC applications, set your Java JNLP setting to at least `Prompt User` (Control Panel > Java > Advanced Tab > “JNLP File/MIME Association).

为了启动FTPC应用程序，请至少将您的Java JNLP设置设置为`Prompt User`（控制面板> Java>高级选项卡>“JNLP文件/ MIME关联”）。

#### Figure 2-2:    JNLP File/MIME Association Setting
#### 图2-2：JNLP文件/ MIME关联设置
![Figure 2-2:    JNLP File/MIME Association Setting](https://gitee.com/uploads/images/2018/0605/143758_3a19739d_460571.jpeg "jboss (3).jpg")

# Chapter 3

# 第3章

# Install FTPC Stand-Alone

# 独立安装FTPC

#### In this chapter:

#### 在这一章当中：

- `Stop Other Applications    18`
- `Run the FTPC Installer    18`
- `Verify the standalone.conf.bat File    25`
- `Configure Default Tab Behavior (Optional)    26`
- `Launch the Applications    27`

If you are upgrading from a previous FTPC installation, please refer to `“Upgrade FTPC Installation Checklist” on page 11` for information.

如果您从以前的FTPC安装升级，请参阅`“Upgrade FTPC Installation Checklist” on page 11`信息。

#### Stop Other Applications

#### 停止其他应用程序

Before you can install FTPC using the JBoss Stand-Alone Installer, you must stop any other applications that listen on ports 8080 or 8081. If IIS, Apache, or any other HTTP Server is started, it may interfere with the JBoss Stand-Alone Installer.

在使用JBoss独立安装程序安装FTPC之前，必须停止侦听端口8080或8081的任何其他应用程序。如果IIS，Apache或任何其他HTTP服务器已启动，则它可能会干扰JBoss Stand-Alone Installer 。

To stop the services on a Windows server:

停止Windows服务器上的服务：

1. Select Start > Settings > Control Panel > Administrative Tools > Services.

选择开始>设置>控制面板>管理工具>服务。

2. If the World Wide Web Publishing Service is running, stop the service.<br>如果万维网发布服务正在运行，请停止该服务。

3. Set the Startup Type to Manual. Click [OK].

将启动类型设置为手动。点击[确定]。

4. Stop any other HTTP Servers or applications using the ports listed, and set the Startup Type to Manual. Click [OK].

停止使用列出的端口的任何其他HTTP服务器或应用程序，并将启动类型设置为手动。点击[确定]。

5. Close the window.<br>关闭窗口。

#### Run the FTPC Installer

#### 运行FTPC安装程序

The FTPC JBoss installer is available from the FTPC download site. To download and run the FTPC JBoss installation executable:

FTPC JBoss安装程序可从FTPC下载站点获得。要下载并运行FTPC JBoss安装可执行文件：

1. Log in to Windows as the Installation Administrator. This is required because you are installing FTPC immediately after downloading it. See `“Types of User Logins” on page 8` for more information.

以安装管理员身份登录到Windows。这是必需的，因为您在下载后立即安装FTPC。查看“Types of User Logins” on page 8更多信息。

2. To run the FTPC installer, right-click on the installation executable file and select `Run as administrator`. You will be asked to confirm that you want to install FTPC. Click [Yes] to begin the extraction.

要运行FTPC安装程序，请右键单击安装可执行文件并选择Run as administrator。您将被要求确认您想要安装FTPC。点击[是]开始提取。

3. On the welcome screen, click [Next].

在欢迎界面上，点击[下一步]。

#### Figure 3-1:    Welcome Screen
#### 图3-1：欢迎屏幕
![Figure 3-1:    Welcome Screen](https://gitee.com/uploads/images/2018/0605/143805_46391f8c_460571.jpeg "jboss (4).jpg")

4. In the License Agreement screen, accept the license agreement, and then click [Next].

在许可协议屏幕中，接受许可协议，然后单击[下一步]。

#### Figure 3-2:    License Agreement
#### 图3-2：许可协议
![Figure 3-2:    License Agreement](https://gitee.com/uploads/images/2018/0605/143813_09b68a50_460571.jpeg "jboss (5).jpg")

5. On the Select Installation Directory screen, accept the default location or browse to a new location. Click [Next] once the directory has been specified.

在“选择安装目录”屏幕上，接受默认位置或浏览到新位置。一旦指定了目录，请点击[下一步]。

#### Figure 3-3:    Select Installation Directory
#### 图3-3：选择安装目录
![Figure 3-3:    Select Installation Directory](https://gitee.com/uploads/images/2018/0605/143818_5dc5da67_460571.jpeg "jboss (6).jpg")

6. On the Pre-Installation Summary screen, click [Install] to start the installation. The installation process may take several minutes to complete.

在“预安装摘要”屏幕上，单击[安装]开始安装。安装过程可能需要几分钟才能完成。

#### Figure 3-4:    Pre-Installation Summary
#### 图3-4：预安装摘要
![Figure 3-4:    Pre-Installation Summary](https://gitee.com/uploads/images/2018/0605/143825_a53fc9c0_460571.jpeg "jboss (7).jpg")

The installation progress will be shown as follows:

安装进度将显示如下：

#### Figure 3-5:    Installation Progress
#### 图3-5：安装进度
![Figure 3-5:    Installation Progress](https://gitee.com/uploads/images/2018/0605/143831_decf564d_460571.jpeg "jboss (8).jpg")

7. On the Enter Database Information screen, enter the following information, then click [Next]:

在输入数据库信息屏幕上，输入以下信息，然后单击[下一步]：

> IMPORTANT:
> 重要提示：
> Entering database information is required. Only MS SQL Server databases are supported.
> 输入数据库信息是必需的。仅支持MS SQL Server数据库。

- `Server Name`: enter the database server machine name.

- `Server Name`：输入数据库服务器的机器名称。

- `Database Name`: enter the name of the production database.

- `Database Name`：输入生产数据库的名称。

- `User Name`: enter the database user name.

- `User Name`：输入数据库用户名。

- `Password`: enter the database password.

- `Password`：输入数据库密码。

- `Port`: enter the database port number (the default is 1433).

- `Port`：输入数据库端口号（默认为1433）。

#### Figure 3-6:    Enter Database Information
#### 图3-6：输入数据库信息
![Figure 3-6:    Enter Database Information](https://gitee.com/uploads/images/2018/0605/143837_55acf51f_460571.jpeg "jboss (9).jpg")

8. On the Database Operations screen, select one of the following radio buttons depending on the action you wish to take. Then, click [Next]:

在数据库操作屏幕上，根据您希望采取的操作选择以下单选按钮之一。然后，点击[下一步]：

- `Initialize database`: select this radio button to initialize the production database. Choose this option if this is a new installation and your database contains no data. Continue to the next step.

- `Initialize database`：选择这个单选按钮来初始化生产数据库。如果这是一个新的安装并且您的数据库不包含任何数据，请选择此选项。继续下一步。

- `Update database`: select this radio button to update the production database from one minor schema version to another minor schema version (for example, 10.42 to 10.43). This option is not available if your database is up-to-date.

- `Update database`：选择此单选按钮可将生产数据库从一个小模式版本更新到另一个小模式版本（例如10.42到10.43）。如果您的数据库是最新的，则此选项不可用。

- `Migrate database`: select this radio button to migrate the production database from one major schema version to another major schema version (for example, 9.4 to 10.4). For more information about migration, see `“Migrate the Databases” on page 44`. The Migrate database radio button is only available if you are upgrading from a previous version of FTPC. Otherwise, it is grayed out.

- `Migrate database`：选择此单选按钮可将生产数据库从一个主要模式版本迁移到另一个主要模式版本（例如9.4到10.4）。有关迁移的更多信息，请参阅“Migrate the Databases” on page 44。迁移数据库单选按钮仅在您从以前版本的FTPC升级时可用。否则，它会变灰。

- `Do not modify database`: select this radio button to leave the database unmodified. A screen displays indicating that no changes are to be made to the database. Click [Next] and skip to `step 11 on page 24`.

- `Do not modify database`：选择这个单选按钮可以不修改数据库。将显示一个屏幕，指示不会对数据库进行更改。点击[下一步]并跳至step 11 on page 24。

#### Figure 3-7:    Database Operations
#### 图3-7：数据库操作
![Figure 3-7:    Database Operations](https://gitee.com/uploads/images/2018/0605/143846_5eac4869_460571.jpeg "jboss (10).jpg")

9. If you chose to initialize the database, the Database Operations Summary screen will display the database information again. Ensure that this is the correct database, and then click [Next] to begin the initialization.

如果您选择初始化数据库，则“数据库操作摘要”屏幕将再次显示数据库信息。确保这是正确的数据库，然后单击[下一步]开始初始化。

#### Figure 3-8:    Database Operations Summary
#### 图3-8：数据库操作摘要
![Figure 3-8:    Database Operations Summary](https://gitee.com/uploads/images/2018/0605/143853_0430261d_460571.jpeg "jboss (11).jpg")

10. After the database has finished initializing, define the site number and ID on the Set Site Number screen. Either accept the default site number and site ID or enter a unique integer value for the site number and any alpha-numeric site ID and click [Next]. The site number will identify your database, so make a note of it for possible future use.

数据库完成初始化后，在“设置站点编号”屏幕上定义站点编号和ID。接受默认站点编号和站点ID，或输入站点编号和任何字母数字站点编号的唯一整数值​​，然后单击[下一步]。网站号码将标识您的数据库，因此请记下它以备将来使用。

#### Figure 3-9:    Set Site Number
#### 图3-9：设置站点编号
![Figure 3-9:    Set Site Number](https://gitee.com/uploads/images/2018/0605/143905_3428c156_460571.jpeg "jboss (12).jpg")

11. On the Installation Successful screen, click [Done].

在安装成功屏幕上，单击[完成]。

#### Figure 3-10:    Installation Successful
#### 图3-10：安装成功
![Figure 3-10:    Installation Successful](https://gitee.com/uploads/images/2018/0605/143912_a882a1af_460571.jpeg "jboss (13).jpg")

12. Start the ActiveMQ, JBoss, and Tomcat servers as either processes or services (but not both). Both methods are explained below:

启动ActiveMQ，JBoss和Tomcat服务器作为进程或服务（但不是两者）。这两种方法解释如下：

- As processes: select Start > Programs > Rockwell Software > FactoryTalk ProductionCentre [`release_number`] > Start Servers.
A command line window opens for each server. Do not close these windows as that will kill the process and is not the recommended method to shut down these servers. The JBoss server has finished the startup sequence when you see a command line entry indicating the amount of time it took to start:
`Started in 2m:45s:906ms`
If you use this menu item to start the servers, then when you need to stop the servers, you must use only the “Stop Servers” menu item to do so.

- 作为进程：选择开始>程序>罗克韦尔软件> FactoryTalk ProductionCentre [ `release_number`]>启动服务器。每个服务器都会打开一个命令行窗口。不要关闭这些窗口，因为这会终止进程，也不是关闭这些服务器的推荐方法。当您看到一个命令行条目指示启动所花费的时间时，JBoss服务器已经完成了启动顺序： 
`Started in 2m:45s:906ms` 
如果使用此菜单项启动服务器，则当您需要停止服务器时，必须仅使用“停止服务器”菜单项来执行此操作。

- As services: register the services by selecting Start > Programs > Rockwell Software > FactoryTalk ProductionCentre [`release_number`] > Register Servers in Windows Services. A command line window opens and confirms that the services were registered successfully. If they were not registered successfully, a detailed error message will be displayed. Press any key to close the window.
To start the services, select Start > Programs > Rockwell Software > FactoryTalk ProductionCentre [`release_number`] > Start Servers in Windows Services. The Windows command line window opens. The servers have finished the startup sequence when you see the following command line entry:
`Press any key to continue... `
If you use this menu item to start the servers, then when you need to stop the servers, you must use only the “Stop Servers in Windows Services” menu item to do so.

- 作为服务：通过release_number在Windows服务中选择开始>程序> Rockwell Software> FactoryTalk ProductionCentre [ `release_number`]>注册服务器来注册服务。命令行窗口打开并确认服务已成功注册。如果他们未成功注册，则会显示详细的错误消息。按任意键关闭窗口。要启动服务，请选择开始>程序> Rockwell Software> FactoryTalk ProductionCentre [ `release_number`]>在Windows服务中启动服务器。Windows命令行窗口打开。当您看到以下命令行条目时，服务器已完成启动顺序： 
`Press any key to continue...` 
如果使用此菜单项启动服务器，则当您需要停止服务器时，

> IMPORTANT:
> 重要提示：
> If you choose to start JBoss server as a service, the user who starts the server must have administrator privileges on the computer where JBoss is being started.
> 如果您选择将JBoss服务器作为服务启动，那么启动服务器的用户必须在JBoss启动的计算机上具有管理员权限。

> IMPORTANT:   
> 重要提示：
> To stop the server, always use the Start > Programs > Rockwell Software > FactoryTalk ProductionCentre [release_number] menu selections. Do not use any other method. Always stop the servers before shutting down or rebooting the machine.
> 要停止服务器，请始终使用开始>程序> Rockwell Software> FactoryTalk ProductionCentre [release_number]菜单选项。不要使用任何其他方法。在关闭或重新启动机器之前务必停止服务器。

#### Verify the standalone.conf.bat File

#### 验证standalone.conf.bat文件

Because ActiveMQ forces users to explicitly whitelist packages that can be exchanged using ObjectMessages, please add the following configuration to the standalone.conf.bat file located at <`JBoss_install`>\bin:

由于ActiveMQ强制用户明确列出可使用ObjectMessages交换的软件包，请将以下配置添加到位于< `JBoss_install`> \ bin 的standalone.conf.bat文件中：

```
set "JAVA_OPTS=%JAVA_OPTS% -Dorg.apache.activemq.SERIALIZABLE_PACKAGES=*"
```

#### Configure Default Tab Behavior (Optional)

#### 配置默认选项卡行为（可选

By default, applications launched in Shop Operations and Process Designer exhibit the Metal Look and Feel (LAF) for the Tab key behavior. This results in some unexpected behavior if you are used to working in an environment with the Windows LAF. For example:

默认情况下，在Shop Operations和Process Designer中启动的应用程序展示Tab键行为的金属外观（LAF）。如果您习惯在具有Windows LAF的环境中工作，这会导致一些意外的行为。例如：

- In the Metal LAF, when you hit the Tab key, the focus moves to the next button, but the default button does not change. The default button is activated by hitting the Enter key (even when it does not have the focus). The focus button is activated using the spacebar.

- 在Metal LAF中，当您按Tab键时，焦点移动到下一个按钮，但默认按钮不会改变。按下Enter键即可激活默认按钮（即使它没有焦点）。使用空格键激活焦点按钮。

- In the Windows LAF, when you hit the Tab key, the focus moves to next button, and it also becomes the default button. The default/focus button is activated by hitting the Enter key or the spacebar.

- 在Windows LAF中，当你点击Tab键时，焦点移动到下一个按钮，并且它也成为默认按钮。点击Enter键或空格键激活默认/焦点按钮。

> NOTE:
> 注意：
> The default button is only configured for certain built-in dialogs (e.g., Performer Signature). Most dialogs and forms do not have a default button.
> 默认按钮仅针对特定的内置对话框进行配置（例如，Performer Signature）。大多数对话框和表单没有默认按钮。

To configure the Tab key behavior to reflect a Windows LAF, perform the following:

要将Tab键行为配置为反映Windows LAF，请执行以下操作：

1. Open the `DSPlantOperations.ear` file and extract the `PlantOpsStaticContent-JBoss.war` file. The `DSPlantOperations.ear` file is located at <`FTPC_install`>\jboss\standalone\deployments. where <`FTPC_install`> is where you installed FTPC.

打开`DSPlantOperations.ear`文件并提取`PlantOpsStaticContent-JBoss.war`文件。该`DSPlantOperations.ear`文件位于< `FTPC_install`> \ jboss \ standalone \ deployments。其中< `FTPC_install`>是安装FTPC的地方。

2. Open the `PlantOpsStaticContent-JBoss.war` file and extract the `ProcessDesigner.htm and ShopOps.htm` files.

打开`PlantOpsStaticContent-JBoss.war`文件并提取`ProcessDesigner.htm and ShopOps.htm`文件。

3. Open the `ProcessDesigner.htm` file using a text editor.

`ProcessDesigner.htm`使用文本编辑器打开文件。

4. Locate the `uiDefaultButtonFollowFocus` argument and update it to true:

找到`uiDefaultButtonFollowFocus`参数并将其更新为true：

```
<param name="uiDefaultButtonFollowFocus" value="true" />
```

5. Save the `ProcessDesigner.htm` file.

保存`ProcessDesigner.htm`文件。

6. Open the `ShopOps.htm` file using a text editor.

`ShopOps.htm`使用文本编辑器打开文件

7. Repeat Step 4.

重复步骤4。

8. Save the `ShopOps.htm` file.

保存`ShopOps.htm`文件。

9. Update the `PlantOpsStaticContent-JBoss.war` file with the updated `ProcessDesigner.htm` and `ShopOps.htm` files.

更新`PlantOpsStaticContent-JBoss.war`与更新的文件`ProcessDesigner.htm`和`ShopOps.htm`文件。

10. Update the `DSPlantOperations.ear` with the `PlantOpsStaticContent-JBoss.war` file you updated in step 9.

更新`DSPlantOperations.ear`与`PlantOpsStaticContent-JBoss.war`您在步骤9更新文件。

11. Deploy the `DSPlantOperations.ear` file on the application server.

`DSPlantOperations.ear`在应用程序服务器上部署文件。

> IMPORTANT:
> 重要提示：
> This configuration only affects the Tab key’s behavior. It does not produce a complete Windows LAF.
> 此配置仅影响Tab键的行为。它不会生成完整的Windows LAF。

See the `FactoryTalk ProductionCentre Activity Developers Guide` for configuration required in the IDE to support the Windows LAF for the Tab key behavior.

#### Launch the Applications

> NOTE:
> If you will be launching FTPC applications (i.e., Process Designer or Shop Operations) using Java Web Start, make sure your client machine has a Java version higher than 1.5 installed and the JAVA_HOME variable is defined.

To run the FTPC applications:

1. Access the FTPC home page by entering the following case-sensitive URL in a web browser:
```
http://<machine_name>:<port_number>/PlantOperations/index.htm
```
where <`machine_name`> is the name of the machine where FTPC and JBoss are installed and <`port_number`> is the HTTP server port number, such as 8080.

When accessing the FTPC home page:

- If you have any JRE that supports Web Start on your client machine, then the JRE supported by Plant Operations will be downloaded onto your machine. You will not be prompted, and Administrative privileges are not required. If you have multiple versions of a JRE installed, the FTPC Java client will only use one for the deployment Web Start. After deployment, FTPC will download and use only the version that it supports.

- If you do not have a JRE version that supports Web Start or no JRE at all on your client machine, you will be prompted to install the JRE supported by Plant Operations. The logged-on user must have Administrative privileges to install the JRE.

#### Figure 3-11:    FTPC Home Page
![Figure 3-11:    FTPC Home Page](https://gitee.com/uploads/images/2018/0605/143920_04ff0166_460571.jpeg "jboss (14).jpg")

2. Click on the appropriate link to launch the application. The JAR files associated with the application will download to C:\.FTPC\<`serverHost`>\ProductionCentre\. The JAR files are only downloaded once.

> IMPORTANT:
> Do not modify any of the downloaded JAR files.

> NOTE:
> If using Java Web Start, please make sure your Java console is configured correctly according to `“Configure the Java JNLP Setting” on page 15`. If you see a prompt regarding JNLP files (`Figure 3-12`), save the file, open the folder location (`Figure 3-13`), and then execute the file by double-clicking it.

#### Figure 3-12:    JNLP File Prompt
![Figure 3-12:    JNLP File Prompt](https://gitee.com/uploads/images/2018/0605/143928_0b9a8d88_460571.jpeg "jboss (15).jpg")

#### Figure 3-13:    Open JNLP Folder
![Figure 3-13:    Open JNLP Folder](https://gitee.com/uploads/images/2018/0605/143935_ecc1f84a_460571.jpeg "jboss (16).jpg")

If you have upgraded to a new version FTPC, the system will check if the JAR files are up-to-date. If they are not, everything in the client cache will be deleted when new JAR files to be downloaded are detected. If the deletion returns an error (for example, some files are locked due to an application running), a dialog displays asking you to close all FTPC applications (Process Designer, Shop Operations, etc.) and then try again.

The main page has links to individual pages that use an Web Start to launch the individual applications. You can create bookmarks that take you directly to the individual application’s home page. The URLs are listed below:

- `Shop Operations`: http://<`server`>:<`port`>/PlantOperations/ShopOps.htm

- `Process Designer`: http://<`server`>:<`port`>/PlantOperations/ProcessDesigner.htm

- `FTPC Administrator`: http://<`server`>:<`port`>/FTPCAdmin/FTPCAdmin

If you encounter an out-of-date error with Internet Explorer when trying to launch the FTPC applications, perform the following steps:

1. Run the following in a command window:
```
reg add "HKCU\Software\Microsoft\Internet Explorer\VersionManager" /v DownloadVersionList /t REG_DWORD /d 0 /f
```

2. Delete the versionlist.xml file located at
C:\Users\<`username`>\AppData\Local\Microsoft\Internet Explorer\VersionManager.

# Chapter 4

# Configure the Database Connections

#### In this chapter
- `Configure and Deploy the Datasources    32`
- `Register the Databases    34`
- `Initialize the Databases    35`
- `Define JMS Connection Information    36`
- `Disable the Ability to Delete or Rename Users (Optional)    37`


Once you have installed FTPC, you can set up your database connections manually.

#### Configure and Deploy the Datasources

To set up your SQL Server database connections, perform the following set of instructions.

> IMPORTANT:
> You must have your Production datasource configured before you finish the Custom Security Provider configuration.

> NOTE:
> When creating your XML files, make sure the XML is formatted according to the XML structure. Copying and pasting from this guide will not work without reformatting the XML.

To set up a new MS SQL Server database configuration manually, perform the following steps.

1. Navigate to <`jboss_install`>\standalone\configuration\ and open standalone-full.xml using a text editor.

2. After the <datasources> element, add the following text:
```
<datasource jndi-name="java:/jdbc/PlantOperationsActiveDB"
            pool-name="PlantOperationsActiveDB"
            enabled="true"
            use-java-context="true">
	<connection-url>
		jdbc:sqlserver://<host>:1433;DatabaseName=<DatabaseName>;responseBuffering=adaptive
	</connection-url>
	<driver>SqlServerJDBC</driver>
	<pool>
		<min-pool-size>5</min-pool-size>
		<max-pool-size>200</max-pool-size>
	</pool>
	<security>
		<user-name>username</user-name>
		<password>password</password>
	</security>
	<validation>
		<check-valid-connection-sql>select count(*) from SITE_INFO</check-valid-connection-sql>
		<background-validation>true</background-validation>
		<background-validation-millis>15000</background-validation-millis>
	</validation>
	<timeout>
		<blocking-timeout-millis>60000</blocking-timeout-millis>
		<idle-timeout-minutes>0</idle-timeout-minutes>
	</timeout>
	<statement>
		<track-statements>false</track-statements>
		<prepared-statement-cache-size>50</prepared-statement-cache-size>
	</statement>
</datasource>
```

where:
- <`host`> is the hostname of the database server.

- <`DatabaseName`> is the database name.

- <`username`> is the database user name.

- <`password`> is the database password.

> NOTE:
> The password is not encrypted by default. The application server relies on file security to keep the password secure.

> NOTE:
> When creating your XML files, make sure the XML is formatted according to the XML structure. Copying and pasting from this guide will not work without reformatting the XML.

3. Before the </drivers> element, add the following text:
```
<driver name="SqlServerJDBC"
        module="com.microsoft.sqlserver.jdbc">
	<driver-class>com.microsoft.sqlserver.jdbc.SQLServerDriver</driver-class>
</driver>
```

4. Save your work and close the file.

#### Register the Databases

Before you can initialize or migrate a database, the database must be registered in FTPC Administrator so that FTPC Administrator can be used to manage the database.

> NOTE:
> Registering your databases in FTPC Administrator does not create the connection to the application server. This is done when you deploy the datasources. See `“Configure and Deploy the Datasources” on page 32` for details.

1. Click the `Register Database` link on the home page to go to the Database Registration screen.

2. Enter the following information:

- `Name`: enter a name or ID for the administered component. The name should be unique among all administered components managed by this FTPC Administrator.

- `Description`: enter a description for the administered component for ease of identification.

- `Type`: Select either `Production` or ODS.

- `Vendor`: Select `MS SQL`.

- `Drive Type`: Specifies the driver type to use for this connection.
  - If this is a Microsoft SQL Server database, the driver type is `type4`.
  - If you want to set up database mirroring for a Microsoft SQL Server database, the driver type is `mirroring`.
  - If you want to set up AlwaysOn Availability Groups for a High Availability configuration, the driver type is `alwaysOnGroup`.

The following properties displayed depends on the Vendor and Driver Type chosen:

- `(Type4 Only) Server`: enter the server name for the database.

- `(Mirroring Only) Principal and Mirror Server`: for both the principal server and the mirror server, enter the host node definition separated by a comma. For example, serverA,serverB. In this instance, serverA is the principal server, and serverB is the mirror server.


- `(AlwaysOn Groups Only) Listener Server`: enter the listener server’s IP address.

- `Database Name`: enter the name of the database.

- `User Name`: enter the user name for a user who has privileges on this database.

- `Password`: enter the password corresponding to the user name.

- `Port`: enter the port on which you will connect to the database. The default is 1433.

- `Change Comment`: Enter a comment for this action.

All fields are required except for the `Description` and `Change Comment` fields.

3. Click [Verify] to test the database connection.

> NOTE:
> You must verify the database connection in order to save your registration. The OK button will not be enabled until the database connection is verified.

If the Administered Component (Service) is not running, the verification will fail even if the information is correct. A dialog will be displayed to inform you if the test succeeded or failed.

4. Click [OK] to close the registration dialog and [OK] again to save the registration. A dialog asking for your password displays.

5. Enter your password and click [OK]. A registration confirmation dialog displays.

6. Click [OK] to close the confirmation dialog.

#### Initialize the Databases

> NOTE:
> Only complete the following steps if this is the first time you are setting up your database.

If you are working with a new database, you must initialize it using FTPC Administrator. When you initialize a database, all data (both runtime and buildtime) is deleted and all the tables that FTPC needs to store the data will be created. Additionally, the administration user (admin/admin) that can log into all FTPC applications is also created. Always back up the database before initializing it.

> IMPORTANT:
> Initializing the Production database resets values used by the Live Transfer process. If you are using Live Transfer and you reinitialize your Production database, then you must either reinitialize your ODS or change the site number of your Production database.

To initialize a database:

1. Select the database on the home page, and then click `Initialize Database`.

2. Configure the following:

  - In the `Table Space Mapping` section, assign file groups to each index and table group.

  - In the `Site Info` section, set the database’s site number and site ID. This site number must be unique across all (Production and ODS) databases. Once a site number is set, it cannot be changed unless you re-initialize your database. The site ID can be changed after it is saved.

  - `Change Comment`: Enter a comment for the action.

3. Click [OK]. A confirmation dialog displays.

4. Enter your password into the confirmation dialog and click [OK] to start the initialization. Once you have started the initialization, the progress is tracked on a progress bar in a dialog. After initialization is complete, the dialog closes.

5. Repeat steps `step 1` through `step 4` for any additional Production and ODS databases that need to be initialized.

6. Stop and restart your application server and all running client applications. If you are running Tomcat, you must also restart Tomcat.

If initialization fails:

1. Delete and recreate the database.

2. Run initialization again.

#### Define JMS Connection Information

For any feature that uses ActiveMQ, the JMS connection information must be defined from FTPC Administrator.

To configure the JMS connection information, perform the following steps:

1. Select the database on the home page, and then click `Edit Configuration`.

2. Edit the following fields:

  - `JMS UserName`: Enter the user name for the JMS connection. If left blank, FTPC will use default values.

  - `JMS Password`: Enter the password for the JMS connection. If left blank, FTPC will use default values.

> TIP:
> For ActiveMQ, the user name and password are optional.

  - `JMS Server URL`: Enter the server URL of the JMS connection. If ActiveMQ is not running on the local machine, change the default value of localhost to the hostname or IP address of the machine running ActiveMQ.

3. Click [OK]. A confirmation dialog displays.

4. Enter your password into the confirmation dialog and click [OK] to save the changes.

> TIP:
> For more information on configuring the JMS connection information, please refer to the `FactoryTalk ProductionCentre Administrator User’s Guide`

#### Disable the Ability to Delete or Rename Users (Optional)

You can disable the ability to delete users or change user names. This is done by running the dsDisallowUserDeletion stored procedure on the Production database after initializing the database. This is not intended to be reversible. If you want to change the setting after this stored procedure has been run, you must call FTPC Customer Support for assistance. Because this stored procedure exists only on an initialized Production database, a database administrator must perform this task directly on the Production database.

After the dsDisallowUserDeletion procedure has been run, you must stop and restart the JBoss server. You will not be able to change a user ID or delete a user using the Process Designer interface, the Process Designer API, or the Integrate Web Services API. An error will be returned indicating that this action is not allowed.

# Chapter 5

# Upgrading FTPC

#### In this chapter
- `Pre-upgrade Preparation    40`
  - Disconnect All Clients    40
  - Unlock JRE    40
  - Back Up the FTPC Databases    40
  - Uninstall the FTPC Applications    40
- `Upgrade FTPC From a Previous Build    42`
-  `Additional Upgrade Activities    43`
  - Migrate the Databases    44
  - Upgrade the Message Pack    45

#### Pre-upgrade Preparation

The following sections must be performed if you are upgrading from a previous FTPC installation. If you are upgrading your release of FTPC from a previous build, you must completely uninstall the previous version of FTPC before installing the new one. You cannot install one version on top of an older version. In addition, if the schema version has changed, you must migrate your databases. For complete instructions for migrating the databases, refer to the `FactoryTalk ProductionCentre Administrator User’s Guide`.

> TIP:  In the following steps, <`jboss_install`> is the installation directory of the JBoss server.

#### Disconnect All Clients

Make sure all clients are disconnected from the application server by closing all instances on Shop Operations, Shop Operations Server, Process Designer, and FTPC Administrator. This reduces the chances of the upgrade encountering any problems when deleting obsolete JAR files.

Verify that no clients are running by opening the Windows Task Manager and selecting the `Show processes from all users` checkbox under the Processes tab. Then verify that no java.exe processes are running.

#### Unlock JRE

Verify that the JRE (C:\.FTPC\<`app_server`>\jre<`version`> by default) is not locked by making sure that the jre folder or a file in it is not opened in another program.

#### Back Up the FTPC Databases

Make sure you have backed up the Production and ODS databases. This will allow you to recover if you encounter problems with the upgrade.

#### Uninstall the FTPC Applications

When you run the uninstaller program to uninstall FTPC, both the applications and the JBoss application server are removed. You can also uninstall FTPC from `Add or Remove Programs` in the Control Panel.

To uninstall FTPC:

> NOTE:
> If JBoss, Tomcat, and ActiveMQ have been installed as Windows services, they must be removed before executing the uninstaller. Complete steps 1 and 2 in order to do this.

1. Open a command prompt as an Administrator.

2. Navigate into the directory C:\Rockwell\PO<`version`> and call
`services.bat remove`

3. Open Windows Explorer. Navigate to where you chose to install FTPC.

4. Double-click `Uninstaller.exe`. The uninstall welcome screen displays.

#### Figure 5-1:    Uninstall Welcome Screen
![Figure 5-1:    Uninstall Welcome Screen](https://gitee.com/uploads/images/2018/0605/143942_69c02a8b_460571.jpeg "jboss (17).jpg")

5. Click [Uninstall]. The installer displays a progress screen as FTPC is uninstalling.

#### Figure 5-2:    Uninstall Summary Screen
![Figure 5-2:    Uninstall Summary Screen](https://gitee.com/uploads/images/2018/0605/143949_5ae1b878_460571.jpeg "jboss (18).jpg")

The Uninstall Complete screen displays when the uninstall is complete.

#### Figure 5-3:    Uninstall Complete Screen
![Figure 5-3:    Uninstall Complete Screen](https://gitee.com/uploads/images/2018/0605/143955_e45b6feb_460571.jpeg "jboss (19).jpg")

6. Click [Done] to exit the uninstaller.

#### Upgrade FTPC From a Previous Build

1. Follow the procedures in `Chapter 3, “Install FTPC Stand-Alone”` to install the new build.

2. If your databases need to be migrated, the Data Migration screen appears. Depending on whether the schema version has changed (check the release notes to find out) select the “Migrate database” radio button or the “Do not modify database” radio button, and click [Next].

3. Start the JBoss and Tomcat servers as either processes or servers (but not both). Both methods are explained below.

   - As processes: select Start > Programs > Rockwell Software > FactoryTalk ProductionCentre [`release_number`] > Start Servers.
The Windows command line window opens. Do not close the command line window. This kills the process and is not the recommended method to shut down the JBoss and Tomcat servers. The JBoss and Tomcat servers have finished the startup sequence when you see a command line entry indicating the amount of time it took to start (it may take several minutes for the JBoss server to start):
`Started in 2m:45s:906ms`

   - As services: select Start > Programs > Rockwell Software > FactoryTalk ProductionCentre [`release_number`] > Start Servers in Windows Services.
The Windows command line window opens. The JBoss and Tomcat servers have finished the startup sequence when you see the following command line entry:
`Press any key to continue...`

4. To launch the FTPC home page, see `“Launch the Applications” on page 27` for details.

#### Additional Upgrade Activities

The following section must be performed if you have upgraded from a previous FTPC installation. Before migrating your database, please make sure to do the following tasks to your system:

##### Oracle

- Change the JOB_QUEUE_PROCESSES initialization parameter to disable jobs during migration.

- Turn off the archive log mode for the duration of the migration

> NOTE:
> If you have multiple users (schema) in Oracle do not perform the tasks listed above, instead disable or delete any jobs (FTPC only uses the DBMS_JOB scheduler) that perform operations on the database being migrated. Also, if you have multiple users in Oracle, turning off archive log mode is NOT recommended to increase migration speed because it affects the entire database.

##### SQL Server

- Disable the SQL Server Agent in order to disable jobs during migration.

>NOTE:
> If you have multiple databases on your SQL Server instance, disable or delete any SQL Server Agent jobs that perform operations on the database being migrated.

#### Migrate the Databases

If the schema has changed between the releases, then migrate your databases.

1. From the FTPC home page, launch FTPC Administrator. See `“Launch the Applications” on page 27` for details.

2. Enter the default FTPC Administrator user name and password when prompted, `admin/admin`.
The FTPC Administrator home page displays.

3. Select the database on the home page, and then click `Migrate Database`.

4. Optionally, enter a change comment for this action.

5. Click [OK]. A confirmation dialog displays.

6. Enter your password into the confirmation dialog and click [OK] to start the migration. Once you have started the migration, the progress is tracked on a progress bar in a dialog. After migration is complete, the dialog closes.

7. Exit FTPC Administrator.

8. Stop and start the application server. If you are running Tomcat, you must also restart Tomcat.

> IMPORTANT:
> If you are migrating from a pre-8.2 release, after you have migrated your ODS, you must configure and run the populatePdXfrUpdatePid.bat file to completion. When migrating an existing pre-8.2 ODS, the migration process creates a new column called pd_xfr_update_pid in any table that is loaded by Live Transfer. This column stores the original Production database’s xfr_update_pid value. For the migrated ODS, this value is based on the information in the XFR_LOAD_LOG table. To initially populate the pd_xfr_update_pid column, you must configure and run the populatePdXfrUpdatePid.bat file after you have migrated your ODS.

See the `FactoryTalk ProductionCentre Administrator User’s Guide` for more information on the `populatePdXfrUpdatePid.bat` file and migrating your ODS.

#### Upgrade the Message Pack

If you upgrade your FTPC build but have a database from the prior build, the latest message set for PlantOperationsErrorMessages is not automatically updated. You must update the message set in FTPC Administrator.

To update the message set:

1. Open FTPC Administrator.

2. In the home page, select your database and click `Update System Messages`.

3. Optionally, enter a comment for the action. This comment will be entered into the DS_ADMIN_LOG table as part of the audit control records.

4. Click [OK]. A confirmation dialog displays.

5. Enter your password into the confirmation dialog and click [OK] to start the update. Once you have started the update, the progress is tracked on a progress bar in a dialog. After update is complete, the dialog closes.

# Appendix A

# Using the Shop Operations HMI Client

#### In this appendix
- `Audience and Expectations    48`
- `Install the Shop Operations HMI Client    48`
Set Java Runtime Properties    50
- `Add the Shop Operations HMI Client to an HMI Display    51`
- `Visual Basic API    53`
- `Return Codes for the API    54`
- `Uninstall the Shop Operations HMI Client    55`
- `Upgrade the Shop Operations HMI Client    55`

There is an FTPC Shop Operations HMI Client that can be placed onto a FactoryTalk View display. This control has properties and methods that can be called via Visual Basic Applications (VBA) scripting. The Shop Operations HMI Client needs to be installed in each computer where FactoryTalk View Site Edition Client or FactoryTalk View Studio will display the Shop Operations HMI Client.

> IMPORTANT:
> A build for the Shop Operations HMI Client is not provided with FTPC 10.4. In order to use this client with 10.4, you must download the FTPC 10.3 Shop Operations HMI Client.

#### Audience and Expectations

These instructions are written with the expectation that the user is familiar with:

- Visual Basic programming

- FactoryTalk View Studio and FactoryTalk View Site Edition client

> IMPORTANT:
> Although FTPC supports Java 8, the HMI client requires Java 7.

#### Install the Shop Operations HMI Client

Before you install the Shop Operations HMI Client, verify that the following conditions are met:

- Ensure that FactoryTalk View is installed before running the HMI Client installer. For more information, please refer to the FactoryTalk View documentation.

- The Shop Operations HMI Client version must match that of the FTPC version you are running. To verify this, check the build numbers in the name of the executables.

- The logged-in user must have administrative privileges.

- The Sun JRE must be configured as the default plug-in. The version must match the Sun JDK version listed in the `FactoryTalk ProductionCentre Supported Platforms Guide`.

> IMPORTANT:
> The SUN JRE must be installed in a directory without any spaces. The Shop Operations HMI Client will not work correctly otherwise.

To install the Shop Operations HMI Client, perform the following directions.

1. Obtain the Shop Operations HMI Client installer for your application server and copy it to your machine.

2. Double-click the Shop Operations HMI Client installer. When the welcome screen appears, click [Next].

3. Accept the terms of the license agreement and click [Next].

4. Enter or browse to a location to which the Shop Operations HMI Client files will be extracted and click [Next]. The default location is C:\Rockwell\FT_ProductionCentre\ShopOps_AX.

> IMPORTANT:
> If you choose your own installation location, note that the directory name cannot contain any spaces.

5. On the JRE Installation Reminder screen, click [Next].

6. On the Pre-Installation Summary screen, verify the installation details and click [Install] to start the installation.

7. If you have not already installed the necessary JRE version, a warning appears telling you that the JRE is necessary to run the Shop Operations HMI client and prompting you to install it now. Otherwise, skip ahead to `step 10`.

8. If you have not previously installed the necessary JRE, a License Agreement now appears. Read the agreement. If you agree, click [Install].

#### Figure A-1:    JRE Runtime Environment License
![Figure A-1:    JRE Runtime Environment License](https://gitee.com/uploads/images/2018/0605/144003_25b71361_460571.jpeg "jboss (20).jpg")

9. When the JRE has finished installing, a Java Setup - Complete dialog appears. Click [Finish] to exit the install wizard.

#### Figure A-2:    Installation Complete
![Figure A-2:    Installation Complete](https://gitee.com/uploads/images/2018/0605/144013_a59a7099_460571.jpeg "jboss (21).jpg")

10. When all the files have been placed on the hard drive, an Installation Complete screen appears. Click [Finish] to exit the program.

#### Set Java Runtime Properties

After you install the JRE, set the Java runtime properties:

1. Go to Window’s Control Panel and double-click on `Java`.

2. Check the Java runtime parameters by going to the `Java` tab and clicking [View...]. The Java runtime parameter should be listed as:
```
-Dcom.datasweep.plantops.j2eevendor\=JBoss - Djava.ext.dirs\=\Java\jre7\lib\ext;\Java\jre7 axbridge\lib;\Users\<user_name>\Application Data\Rockwell Automation\FactoryTalk ProductionCentre\jars\ShopOps
```
where <`user_name`> is the name of the logged-in user.

3. Open the `deployment.properties` file, located by default at C:\Users\<`user_name`>\AppData\LocalLow\Sun\Java\Deployment where <`user_name`> is the name of the logged-in user.

4. Make sure it contains the following settings:

```
deployment.javaws.jre.0.registered=true
deployment.javaws.jre.0.platform=1.8
deployment.javaws.jre.0.osname=Windows
deployment.javaws.jre.0.path=C\:\\Program Files\\Java\\jre7\\ bin\\javaw.exe
deployment.javaws.jre.0.product=1.8.0_<version>
deployment.javaws.jre.0.osarch=x86
deployment.javaws.jre.0.location=http\://java.sun.com/product
s/autodl/j2se deployment.javaws.jre.0.enabled=true
```

5. In addition to the settings in the previous step, make sure the `deployment.properties` file also contains the following settings:

```
deployment.javaws.jre.0.args=-Dcom.datasweep.plantops.j2eeven dor\=JBoss -Djava.ext.dirs\=\\Java\\jre7\\lib\\ext;\\Java\\jre7\\axbridg e\\lib;\\Users\\<user_name>\\Application Data\\Rockwell Automation\\FactoryTalk ProductionCentre\\jars\\ShopOps -Djava.net.preferIPv4Stack\=true
```

Note this information in case another application modifies these settings and you need to restore them.

> NOTE:
> If you choose to edit this file, you must use Notepad. Other text editors add hidden characters that may cause Java to fail. Note also that the line breaks shown here should be edited out.

#### Add the Shop Operations HMI Client to an HMI Display

After you have installed the Shop Operations HMI client, add the client to an HMI display. To do so, follow the directions below.

1. Open FactoryTalk View Studio.

2. Open your existing application or create a new application inside FactoryTalk View Studio.

3. Inside your application, under the Graphics node in the left-hand pane, right-click Displays and select New to create a new display. The new display appears.

#### Figure A-3:    Add the Shop Operations HMI Client to the New Display
![Figure A-3:    Add the Shop Operations HMI Client to the New Display](https://gitee.com/uploads/images/2018/0605/144022_2cb10683_460571.jpeg "jboss (22).jpg")

4. Add the ActiveX control to the FactoryTalk View display by selecting File > Objects > ActiveX Control.... A dialog appears prompting you to insert an ActiveX control.

#### Figure A-4:    Insert an ActiveX Control
![Figure A-4:    Insert an ActiveX Control](https://gitee.com/uploads/images/2018/0605/144029_1baf4faf_460571.jpeg "jboss (23).jpg")

5. Select `FTViewSO.PCShopOps`, then click [OK].

> IMPORTANT:
> When you open the window to select the Shop Operations HMI Client control to add to your display, two Shop Operations ActiveX controls appear: FTViewSO.PCShopOps and AXShopOps Bean Control. It is very important that you select FTViewSO.PCShopOps. AXShopOps Bean Control is intended for use only by the application.

The Shop Operations HMI Client is added. The following output screen displays the results of the installation.

#### Figure A-5:    Results of Successful Installation
![Figure A-5:    Results of Successful Installation](https://gitee.com/uploads/images/2018/0605/144040_1cb81dad_460571.jpeg "jboss (24).jpg")

6. Right-click the control you just added, and select `VBA Code`. The Microsoft Visual Basic editor appears. You are ready to start adding your code to instruct the control where to connect, to log on to the FTPC Shop Operations HMI Client, open a specific form, or whatever else your application calls for. Go to the next section for the Visual Basic API.

#### Visual Basic API

Following is the Visual Basic API available for use with the Shop Operations HMI Client.

- Public Event propertyChangedByPDForm()

- Public Function changePassword(ByVal newPwd As String) As Integer • Public Function closeSOForm() As Integer

- Public Function connectToServer(ByVal jnp As String, ByVal http As String) As Integer • Public Function getChangedPropertyName() As String

- Public Function getChangedPropertyValue() As String

- Public Function logOff() As Integer

- Public Function logOn(ByVal userName As String, ByVal password As String) As Integer

- Public Function openSOForm(ByVal formName As String) As Integer

- Public Function setBooleanGlobalProperty(ByVal propName As String, ByVal booleanValue As Boolean) As Integer

- Public Function setDoubleGlobalProperty(ByVal propName As String, ByVal doubleValue As Double) As Integer

- Public Function setLanguage(ByVal language As String) As Integer

- Public Function setLanguageCountry(ByVal language As String, ByVal country As String)

- Public Function setLanguageCountryVariant(ByVal language As String, ByVal country As String, ByVal pcVariant As String)

- Public Function setLongGlobalProperty(ByVal propName As String, ByVal longValue As Long) As Integer

- Public Function setNormalScreen() As Integer

- Public Function setStation(ByVal stationName As String, ByVal timeOut As Boolean) As Integer

- Public Function setStringGlobalProperty(ByVal propName As String, ByVal stringValue As String) As Integer

- Public Function setTouchScreen() As Integer This example

###### performs the following tasks:

- Connects to a server using the host name `samplehostname` and remote port 8080.

- Sets the http port to 8080.

- Logs in user `userid`, with the password password.

- Sets the language to French (“fr”).

- Sets the language country to French Canada (“fr”, “CA”).

- Sets the language country variant to French Canada Automotive (“fr”, “CA”, “Automotive”).

- Defines the form that will be opened.

```
FTViewSOPCShopOps1.ConnectToServer  ("remote://samplehostname:8080", "http://samplehostname:8080")
FTViewSOPCShopOps1.LogOn("userid", "password")
FTViewSOPCShopOps1.SetLanguage("fr")
FTViewSOPCShopOps1.SetLanguageCountry("fr", "CA")
FTViewSOPCShopOps1.SetLanguageCountryVariant("fr", "CA", "Automotive")
FTViewSOPCShopOps1.OpenSOForm("formName")
```

Once you enter the code into the Visual Basic editor, you must test the code. To do so, either test the display or launch FactoryTalk View Site Edition Client. If the code shown in this example were to be located in the Display_Load method, the display would connect, log on, and open the form once the display was loaded.

#### Return Codes for the API

The table below lists numerical codes that describe information or the status of the operation. Return codes that range between 1 and 99 are error indicators. 101 through 199 are informational.

> NOTE:
> For every operation, code 0 appears for a successful operation. If the operation fails, the default error code is 1. If there is more information about the cause of the failure, other more descriptive error codes may appear.

Code | Meaning
-|-
Error  Codes | |
0 | Operation ok
1 | Operation failed
2 | Error when getting database information
3 | Database schema error
4 | Application error
5 | System error
6 | Invalid username password
7 | Invalid password length
8 | Invalid argument
9 | Password expired
51 | Not connected
52 | Not logged on
53 | No privilege
Informational Codes | |
101 | Password about to expire
102 | Default form loaded Code Meaning

#### Uninstall the Shop Operations HMI Client

To uninstall the Shop Operations HMI Client, perform the following directions.

> WARNING:
> Do not use FactoryTalk View to unregister the Shop Operations HMI Client. Use the Shop Operations HMI uninstaller.

1. In Windows Explorer, navigate to: C:\<`ShopOperations_AXinstall_location`>\ShopOps_AX\_uninst. Double-click uninstaller.exe.

2. When the uninstall wizard appears, click [Next].

3. Select the features you want to uninstall (or accept the default selections) and click [Next].

4. Click [Uninstall] to start the uninstallation.

5. A screen appears telling you that the uninstallation was successful. Click [Finish] to continue.

#### Upgrade the Shop Operations HMI Client

The build numbers for the Shop Operations HMI Client and for FTPC must match. Therefore, uninstall, reboot, and reinstall the Shop Operations HMI Client each time you upgrade FTPC.

> IMPORTANT:
> Because of a known Microsoft issue, the following three steps are necessary when upgrading to a new build. For more information about this issue, please refer to Microsoft’s support website, http://support.microsoft.com.

1. Delete the `FTViewSO.exd` file from <`FTViewStudio_install`>\RSView Enterprise\VBA, where <`FTViewStudio_install`> is the location where FactoryTalk View Studio is installed on your system.

2. Back up and remove your HMI client’s current `deployment.properties` file to allow the HMI installer to generate a new file. You can modify the file to reapply any custom configuration after the installation.

> NOTE:
> After installing the new HMI client, you do not need to replace the ActiveX control from each display. The following steps allow you to upgrade the ActiveX control for your all of your views.

3. Open FactoryTalk View Studio.

4. Open your existing application or create a new application inside FactoryTalk View Studio.

5. Create a new display for the open application.

6. Add the ActiveX control to the FactoryTalk View display by selecting File > Objects > ActiveX Control

7. Unregister the ActiveX control you just added by clicking [Unregister…].

8. Re-register the same control by clicking [Register] and selecting the correct OCX file.

9. In the Property Panel for the Shop Operations HMI Client, change the control’s `ExposeToVBA` property from `Not Exposed to VBA` Control.

#### Figure A-6:    Property Panel
![Figure A-6:    Property Panel](https://gitee.com/uploads/images/2018/0605/144050_d383c1f7_460571.jpeg "jboss (25).jpg")

# Appendix B

# Shop Operations Server

#### In this chapter:
- `Prerequisites    59`

- `Downloading Shop Operations Server    59`

- `Installing Shop Operations Server    60`
Installing as a Windows Administrator    60
Installing as an Administrator User Group Member    63

- `Modifying the Startup Delay Interval (Optional)    63`

- `Configure the Function Thread Pool Size (Optional)    64`

- `Run Shop Operations Server    64`

- `Administering Shop Operations Server    66`
Configuring the Server    67
Configuring the User    68
Configuring Logging    69

- `Using Event Sheets    70`
Run an Event Sheet    72
Monitor the Event Sheet    72

- `Viewing Logs    78`
Viewing Error/Information Logs    78
Logging Debug Messages    80
Viewing Println Output    80
Viewing Application Logs    81

- `Configuring Failover    84`
Limitations    88

- `Uninstalling Shop Operations Server    88`

- `Upgrading Shop Operations Server    88`

Shop Operations Server is a Java application that performs as a runtime client to Plant Operations server. It provides a runtime environment for event sheets, which are non GUI-driven applications developed in Process Designer. Operationally, Shop Operations Server is downloaded to and run on a separate machine from the Plant Operations server. Each Shop Operations Server instance runs one event sheet.

Shop Operations Server runs in Windows and Linux. A Java Service Wrapper is used to install and run Shop Operations Server as a Windows service or Linux daemon. This allows Shop Operations Server to run in the background and be automatically started when the operating system boots up.

Shop Operations Server also contains an embedded servlet engine to process web services events and to host an administration console that is used for configuration and monitoring of event sheets. An event sheet running in two Shop Operations Server instances can have failover support when the Shop Operations Server instances are configured for failover. Note that Shop Operations Server cannot write to remote file systems.

Event sheets running in Shop Operations Server support the creation and management of event sources for executing script code. Supported event sources are:

- FactoryTalk Live Data

- Timer (repetitive events)

- Calendar (scheduled events) • Serial port (RS232)

- Socket (TCP/IP and UDP multicast)

- Message groups (from other event sheets and forms)

- Web services

- Event sheet events (Pnuts script functions and events such as before or after an event sheet is started or stopped)

Event sheets provide a framework for developing non GUI-driven applications. Process Designer is used to develop event sheets that are then run in Shop Operations Server, which can be configured to provide failover for event sheets.

`Figure B-1` provides an overall functional depiction of Shop Operations Server.

#### Figure B-1:    Shop Operations Server
![Figure B-1:    Shop Operations Server](https://gitee.com/uploads/images/2018/0605/144058_e516a1e6_460571.jpeg "jboss (26).jpg")

This chapter describes the installation, configuration, administration, and operation of Shop Operations Server.

#### Prerequisites
These instructions are written with the expectation that the user is familiar with Windows services and how to install them.

#### Downloading Shop Operations Server

To download the Shop Operations Server archive, follow the steps below.

1. From the FTPC home page, click the Downloads link.

2. From the Downloads page, click the Shop Operations Server link. The Shop Operations Server archive is the ShopOperationsServer.zip file.

3. A dialog appears, prompting you to specify an extraction location on the target machine. Navigate to the location of your choice.

4. Extract the contents of ShopOperationsServer.zip into the desired location. These Shop Operations Server folders are extracted to this location: `bin, conf, lib, logs, java, META-INF, plug-ins, and properties`. Note the following folders:

   - `bin` - contains the Windows batch files used to install, start, stop, and uninstall Shop Operations Server. It also contains the Java Service Wrapper wrapper.exe file from Tanuki Software for running the Windows service. The ShopOperationsServer.xml configuration file is also in this folder.

   - `conf` - contains the wrapper.conf file used to configure the Shop Operations Server.

   - `lib` - contains the Java library (JAR) files. The NativeLibsWin32.jar subfolder contains native Windows DLL files.

   - `logs` - contains the wrapper.log file. This file contains error and informational messages as well as application information originating from the println script statement. This is a rolling log file, so older files will have a number appended to the end of the file name (e.g., 1, 2, 3...) up to the number of log files configured for retainment. Consult these files if the application is not functioning correctly.

#### Installing Shop Operations Server

To install Shop Operations Server, you must either be logged in as a Windows administrator or be in the Windows administrator user group.

##### Installing as a Windows Administrator

If you are logged in as a Windows administrator, perform the following steps.

1. In Windows Explorer, navigate to <`ShopOpsServer_install`>\conf, where <`ShopOpsServer_install`> is the location where you extracted the Shop Operations Server files.

2. Open wrapper.conf in a text editor and modify the wrapper.java.additional.2 setting. You will see several lines that begin with wrapper.java.additional.2. Locate the one for your application server type, and uncomment it. Verify that all the other server types are commented out.

3. Add an additional wrapper.java.additional property after the other wrapper.java.additional properties and name it accordingly. For example, if there are eight wrapper.java.additional properties, this new property would be added after wrapper.java.additioal.8 and be called wrapper.java.additional.9.
NOTE:  This step is only needed if the code requires additional lines. If no additional lines are needed, skip this step.

4. Save your work and close the file.

5. Set the JAVA_HOME variable on your computer to <`JRE_install`>, where <`JRE_install`> is the location where the SUN JRE is installed on your computer.

6. In <`ShopOpsServer_install`>\bin, open ShopOperationsServer.xml in a text editor.

7. Locate the http-uRL and iiop-uRL properties and verify that they are configured correctly for your installation. For example: http://<`server_name`>:<`embedded_port`> where <`server_name`> is the name of the machine where FTPC is installed, and <`embedded_port`> is the web server port number.

8. Locate the jetty-port value. This is the embedded web service port number. Set it to a port that will not conflict with any other processes running on the computer. Save your work and close the file.

9. In Windows Explorer, navigate to <`ShopOpsServer_install`>\bin.

10. Double-click on InstallApp-NT.bat to install the Windows service.

11. Double-click on StartApp-NT.bat to run the Windows service.

> TIP:
> See `“Run Shop Operations Server”` on page 64 for additional methods for running Shop Operations Server.

12. Open a browser and go to http://<`ShopOpsServer_name`>: <`jetty_port`>/ShopOperationsServer.

#### Figure B-2:    Shop Operations Server Login
![Figure B-2:    Shop Operations Server Login](https://gitee.com/uploads/images/2018/0605/144110_f8c30f7c_460571.jpeg "jboss (27).jpg")

13. When the Shop Operations Server Login page appears, enter your user name and password. The following screen appears. The default login user/password is `admin/admin`. This can be changed later.

#### Figure B-3:    Shop Operations Server Administrative Console
![Figure B-3:    Shop Operations Server Administrative Console](https://gitee.com/uploads/images/2018/0605/144120_8acc3baa_460571.jpeg "jboss (28).jpg")

14. (Optional) If you want to run multiple Shop Operations Servers on a machine, the Shop Operations Server archive must be copied to different locations on the machine and each instance must be configured separately. If you want to enable failover support, then two Shop Operations Servers must be running the same event sheet. If one Shop Operations Server is running, then the other will be in standby mode and will only start processing if the first Shop Operations Server stops running. For more information about configuring failover support, see `“Configuring Failover” on page 84`. To install multiple Shop Operations Server services, note the following:

    - Each Shop Operations Server must be installed on a separate directory.

    - The jetty-port property must be configured in the ShopOperationsServer.xml file located in the bin subdirectory. The port for the embedded jetty web server must be unique.

    - The ntservice.displayname property must be configured in the wrapper.conf file located in the Shop Operations Server’s conf directory so that the name of each Shop Operations Server service is unique. For example: wrapper.ntservice.displayname=Rockwell Shop Operations Server2

    - The ntservice.name property must be configured in the wrapper.conf file located in the Shop Operations Server’s conf directory so that the name of each Shop Operations Server service is unique. For example: wrapper.ntservice.name=Rockwell Shop Operations Server2

    - (Optional) Update the corresponding service description property. For example:
`wrapper.ntservice.description=Shop Operations Server`

15. (Optional) To use a third-party jar, uncomment the Java Library Path property and add the location of the jar to it. This property is configured in the wrapper.conf file located in the Shop Operations Server’s conf directory.
`wrapper.java.library.path.1=../lib;../lib/NativeLibsWin32.jar`

> IMPORTANT:
> If you will be running Shop Operations Server with Live Data, the Java Library Path property line must be uncommented.

#### Installing as an Administrator User Group Member

If you are not a Windows administrator but are in the administrator user group, perform the following steps.

1. Follow `step 1` through `step 8` of `“Installing as a Windows Administrator” on page 60`.

2. Go to Start > All Programs > Accessories. Right-click on Command Prompt and select Run as Administrator. The command prompt window opens.

3. Change to the location of the Shop Operations Server installation bin folder.

4. Run the following command: InstallApp-NT.bat

5. Follow `step 11` through `step 13` of `“Installing as a Windows Administrator” on page 60`.

#### Modifying the Startup Delay Interval (Optional)

If your application server and Shop Operations Server are both running on the same machine and are both configured to run as Windows services, Shop Operations Server may start up before the application server is ready to communicate. In this situation, the Shop Operations Server will receive an exception when it tries to connect to the application server and then terminate. To solve this problem, you can configure Shop Operations Server to have a delayed startup by defining the following configuration parameters in the Java Service Wrapper configuration files.

If Shop Operations Server is started as a service, perform the following directions.

1. Navigate to <`ShopOpsServer_install`>/conf where <`ShopOpsServer_install`> is the location where Shop Operations Server is installed.

2. Open the wrapper.conf file and locate the following line:
`wrapper.startup.delay.service=0`

3. Configure the startup delay in seconds. The default is 0 (no delay).

4. Save your work and close the file.

5. Restart Shop Operations Server.

If Shop Operations Server is started from the console, perform the following directions.

1. Navigate to <`ShopOpsServer_install`>/conf where <`ShopOpsServer_install`> is the location where Shop Operations Server is installed.

2. Open the wrapper.conf file. Locate the following line:
`wrapper.startup.delay.console=0`

3. Configure the startup delay in seconds. The default is 0 (no delay).

4. Save your work and close the file.

5. Restart Shop Operations Server.

Because of the delayed startup, Shop Operations Server will be able to connect to the application server after it starts. The optimum startup delay for your system depends on many factors, including your hardware and software configuration. Please contact your administrator for more information.

#### Configure the Function Thread Pool Size (Optional)

If your event sheet will process events that will be handled in parallel, the events should be handled with Function.runFunctionThread(...), which allows events to be processed by a pool of worker threads. The default number of worker threads is 25. The optimum number of threads for your application may vary depending on your system configuration. This number can be changed if necessary, within the limits of your system configuration. To do so, perform the following steps.

1. In <`ShopOpsServer_install`>\bin, open ShopOperationsServer.xml in a text editor.

2. Locate the following line and define the number of worker threads. The default is 25.
`function-thread-pool-size="25"`

3. Save your work and close the file.

4. Restart Shop Operations Server.

#### Run Shop Operations Server

Shop Operations Server can be started and stopped using the following methods.

- To run Shop Operations Server as a Windows service, use the Windows Services Control Panel. Look for the “Rockwell Shop Operations Server” service. Before you can run Shop Operations Server as a service, you must install it as a service by running the InstallApp-NT.bat file located at <`SOS_install`>\bin.

  To run Shop Operations Server as a service, you must either be logged in as a Windows administrator or be in the Windows administrator user group. If you are not a Windows administrator but are in the administrator user group, perform the following steps.

- `a.` To register Shop Operations Server as a service, open the Services console by going to Start > Run and entering services.msc.

- `b.` In the list of `services`, right-click on `Rockwell Shop Operations Server` and select Properties.

- `c.` Select the Log On tab, and select This Account.

#### Figure 0-1:    Log On Tab
![Figure 0-1:    Log On Tab](https://gitee.com/uploads/images/2018/0605/144128_cb0266e0_460571.jpeg "jboss (29).jpg")

- `d.` Enter the system administrator’s user name and password, then click [OK].

- `e.` Go to Start > All Programs > Accessories. Right-click on Command Prompt and select `Run as Administrator`. The command prompt window opens.

- `f.` Change the location to <`SOS_install`>\bin.

- `g.` Run the following command:

```
StartApp-NT.bat
```

- `h.` To stop Shop Operations Server, run the following command:

```
StopApp-NT.bat
```

- If you want to use the Java wrapper, run the App.bat file located in the <`SOS_install`>\bin folder from the command line. This method automatically creates the wrapper.log file because it calls the Java wrapper to start Shop Operations Server. Use this method if you want the wrapper to restart the JVM if it is unexpectedly stopped.
66 Plant Operations Server Installation Guide -  JBoss Standalone

> NOTE:
> When using the Java wrapper with Windows, the socket connection may close unexpectedly at the OS level. See http://wrapper.tanukisoftware.com/doc/english/release-notes.html for details.


- If you do not want to use the Java wrapper, run the runSos.bat file from the command line. This file is also located in the <`SOS_install`>\bin folder. Running this file will not create the wrapper.log file.

#### Administering Shop Operations Server

The Shop Operations Server administration console allows the user to configure the system, view the event log, view event history, and monitor system performance. To access the administration console, go to http://<`server_name`>:<`port`>/ShopOperationsServer.

> NOTE:
> If you are using Internet Explorer 9, please click the Compatibility View icon in your browser’s address bar to display the administration console’s login page correctly.

The GUI is customized based on which of the five system-defined groups the logged-in user is a member of. Access is defined as follows:

- PlantOpsGuest: can view statistics only, cannot change anything.

- PlantOpsOperator: can view statistics, view the error log, and invoke events.

- PlantOpsSupervisor: has PlantOpsOperator privileges plus the ability to turn statistics on/off and change the configuration of statistics gathered.

- PlantOpsDesigner: has PlantOpsSupervisor privileges plus the ability to change the event sheet configured to run on the Shop Operations Server.

- PlantOpsAdmin: has PlantOpsDesigner privileges plus the ability to configure the logged-in username/password and change the server configuration. An ability to log out of the administration console is also provided. Online help is provided through the use of tool tips where appropriate.

> IMPORTANT:
> Before restarting either an application server or database server, stop Shop Operations Server, then restart it after the other servers are running.


> NOTE:
> If Shop Operations Server is stopped while processing events, the currently executing event will be aborted and all outstanding events discarded. Therefore, the server should be stopped when it is idle (i.e., let all outstanding events complete first). The administration console can be used to choose a time when there is no activity by inspecting server status pages.

#### Configuring the Server

To configure the server, in the left navigation pane, click [Configuration], then [Configure Server].

#### Figure B-4:    Configuring the Server
![Figure B-4:    Configuring the Server](https://gitee.com/uploads/images/2018/0605/144138_48bb2985_460571.jpeg "jboss (30).jpg")

The following items, located in the `New Settings` section, can be configured for the server:

- Event Sheet Name: Select an event sheet from a list of event sheets stored in the database by clicking [Choose...] or enter the name of an event sheet in the database.

- Station Name: Select a station from a list of stations stored in the database by clicking [Choose...] or enter the name of a station in the database.

- Web Server Port: Enter Shop Operation Server’s jetty port number.

- IIOP URL: A pre-configured default value is provided.
68 Plant Operations Server Installation Guide -  JBoss Standalone

- HTTP URL: A pre-configured default value is provided.

- Enable the Statistics flag for charting purposes.

- Enable the event History Queue flag for monitoring purposes.

- Enable the Failover flag to enable and configure Shop Operations Server failover. Refer to the section `“Configuring Failover” on page 84` for information on how failover works and instructions to fill in the MasterHost, SlaveHost, and Failover Port fields.

> NOTE:
> If you want to preserve the existing settings in the ShopOpsServer.xml file, then be sure to save a copy of the file. Any changes you make will overwrite this file.

To save your changes to the ShopOpsServer.xml file, click [Save]. Changes to the following require a restart of Shop Operation Server:

- Event Sheet Name

- Station Name

- IIOP URL

- HTTP application server URL

- Embedded web server port number

- Failover Enable check box

- MasterHost

- SlaveHost

- Failover Port

To undo changes that have not been saved yet, click [Restore] before you click [Save]. This will reset the values to those stored in the ShopOpsServer.xml file.

The following field updates take effect immediately and do not require a server restart:

- Enable statistics flag

- Enable history queue flag

#### Configuring the User

The Configure User screen allows the administrator to specify the username and password of the logged-in user who will be processing event sheets. To configure the user, in the left navigation pane, click [Configuration], then [Configure User]. Enter or confirm the following information, and then click [Save] to save the information to the ShopOperationsServer.xml file.

- User Name

- Password

- Confirm Password Once you have saved your changes, the configuration populates the `Active Settings` section. This section displays the currently saved configuration and is read-only.

#### Figure B-5:    Configuring the User
![Figure B-5:    Configuring the User](https://gitee.com/uploads/images/2018/0605/144741_d2981239_1965798.jpeg "jboss (31).jpg")

#### Configuring Logging

The Configure Logging screen allows the administrator to edit server logging parameters. To configure logging, in the left navigation pane, click [Configuration], then [Configure Logging]. Either accept the default configuration parameters or enter your own information.

- Log Info Level: Enable this flag if you want informational messages as well as errors to be logged. If not enabled, then only errors will be logged. Note that informational logging will negatively impact performance.

- File Size: Enter the maximum file size to allow in megabytes for each log file.

- File Count: Enter the maximum number of files to keep on disk. The oldest file past the file count will be deleted.

- Log Folder on <`machine name`>: Define the path on the specified machine to the location of the log files. The name of each log file is ShopOpsServerLogX.X.xml where X.X indicates the log’s rollover sequence. The most recent log is always numbered 0.0, and the next most recent is 0.1, etc. This file logs information about the execution of the event sheet currently running, such as scripting errors and events that have fired. Once you have saved your changes, the configuration populates the `Active Settings` section. This section displays the currently saved configuration and is read-only.

> IMPORTANT:
> If you have multiple instances of Shop Operations Server installed on one machine, each instance must have a unique log folder defined.

#### Figure B-6:    Configuring Logging
![Figure B-6:    Configuring Logging](https://gitee.com/uploads/images/2018/0605/144751_224dce23_1965798.jpeg "jboss (32).jpg")

#### Using Event Sheets

> NOTE:
> The following section provides a general overview of the structure and function of event sheets. For detailed instruction on creating and configuring event sheets, please refer to the Process Designer and Objects Online Help.

Event sheets provide a framework for developers to create GUI-less applications. Shop Operations Server provides a runtime environment for executing script in event sheets. Event sheets can also be debugged in test mode in Process Designer. An event sheet:

- Is a top-level object (like a form).

- Contains definitions of events grouped into a container type. Event containers have properties and their events have associated script. The types of event containers are as follows:

  - – ActivityEvent: allows the application developer to specify an event to configure, execute, and monitor the execution of activities.

  - – ActivitySetEvent: allows the application developer to specify an event to configure, execute, and monitor the execution of activity sets.

  - – CalendarEvent: allows the application developer to specify an event that fires based on the Gregorian calendar.

  - – JMS MessageEvent: allows the application developer to send and receive JMS messages using an event sheet.

  - – LiveDataEvent: allows the application developer to specify an event that fires based on data from the Live Data server.

  - – MessageGroup Event: provides communication capability over a JGroup channel. – SerialEvent: allows the application developer to specify an event that fires based on data received on a serial port.

  - – SocketEvent: allows the application developer to specify an event that fires based on data received on a socket.

  - – TimerEvent: allows the application developer to specify an event that repeats after a specified time interval.

  - – WebServiceEvent: allows the application developer to specify an event that is invoked by an external web services operation.

  - – UserWebServiceEvent: allows the application developer to specify an event that is invoked by an external user-defined web services operation.

- Supports standard import/export behavior to a DSX file.

- Has script executed when an event occurs.

- Has properties.

- Has events.

Some events in the containers must be triggered by an external application:

- JMS Message: a JMS messageEvent (receiver) is triggered when a JMS message is received.

- Live Data: an OPC server that is monitoring tag values is the source for data change events. The` readComplete` and `writeComplete` events are triggered whenever an asynchronous read or write to a tag completes. The `shutdownRequest` event is triggered when a request is made to shut down an OPC server. The `cancelComplete` event is triggered when an asynchronous read or write is canceled.

- Message Group: the messageGroupEvent is triggered when another form or event sheet sends an application message or when a shared hash table or queue data structure is modified by another form or event sheet.

- Serial: the dataReceivedEvent is triggered when data is received on a serial communication port.

- Socket: the dataReceivedEvent is triggered when data is received on a Windows socket.

- Web Service: the webServiceEvent is triggered when the signalEvent() operation is invoked on the web services interface.

- User Web Service: the userWebServiceEvent is triggered by the user-defined web services class that was created by extending the UserService class.

#### Run an Event Sheet

1. Log on to the Shop Operations Server administrative console.

2. Choose an event sheet from the server configuration page or type in its name.

#### Figure B-7:    Select Event Sheet
![Figure B-7:    Select Event Sheet](https://gitee.com/uploads/images/2018/0605/144802_c2cfd55b_1965798.jpeg "jboss (33).jpg")

3. Stop Shop Operations Server by navigating to <`ShopOpsServer_install`>\bin in Windows Explorer and double-clicking on StopApp-NT.bat to stop the Windows service.

4. Restart Shop Operations Server by navigating to <`ShopOpsServer_install`>\bin in Windows Explorer and double-clicking on StartApp-NT.bat to start the Windows service.

>IMPORTANT:
> If you make any changes to an event sheet that is running in Shop Operations Server, you must stop and restart all instances of Shop Operations Server running that event sheet. This guarantees that the latest version of the event sheet is being executed.

#### Monitor the Event Sheet

The Shop Operations Server administration console allows the user to monitor the event sheet’s performance in a number of different ways. The purpose of the Shop Operations Server event pages and charts is to help you understand how your server is performing.

#### View Event Status The navigation buttons at the bottom of the View Event Status screen allow you to view the following information about your events.

#### Figure B-8:    Bottom Pane Navigation Buttons
![Figure B-8:    Bottom Pane Navigation Buttons](https://gitee.com/uploads/images/2018/0605/144833_184c0dcf_1965798.jpeg "jboss (34).jpg")

- “Events Summary” consists of a table with the following columns:

   - – Source: the source of the event.

   - – Event: the name of the event.

   - – Total Processed: the number of events processed.

   - – Average Processing Time (sec.): the average amount of time in seconds required for processing the event.

   - – Maximum Processing time (sec.): the maximum amount of time in seconds required for processing the event.

  If an event source has unusually large processing times compared to the others, it could indicate that this event is taking too long to execute and thus is a candidate for optimization. Also, if there is a big difference between the average and maximum times, this could indicate that the server is not performing in an optimal manner.

#### Figure B-9:    Events Summary
![Figure B-9:    Events Summary](https://gitee.com/uploads/images/2018/0605/144843_403e9822_1965798.jpeg "jboss (35).jpg")

- “Queue Time” shows the average time an event spent in the queue, the maximum time spent in the queue, and the maximum number of events that were waiting in the queue. Large queue times and a large queue count indicate that the server is not processing events fast enough to keep up with new ones arriving.

#### Figure B-10:    Queue Time
![Figure B-10:    Queue Time](https://gitee.com/uploads/images/2018/0605/144851_2f9c96f1_1965798.jpeg "jboss (36).jpg")

- “Function Thread” shows the total number of times the function was called, the average and maximum queue times for the event that called the function, and the average and maximum processing times for the event that called the function. This information can be used to identify script code isolated to a particular event sheet function that could be a candidate for performance optimization.

#### Figure B-11:    Function Thread
![Figure B-11:    Function Thread](https://gitee.com/uploads/images/2018/0605/144900_4eebcc7c_1965798.jpeg "jboss (37).jpg")

- “Current Event” shows the currently executing event source, the name of the event, and the time when it started processing. A single event that takes an exceptionally long time to process could either indicate inefficient script code or a large amount of processing that needs to be done.

#### Figure B-12:    Current Event
![Figure B-12:    Current Event](https://gitee.com/uploads/images/2018/0605/144910_79884f4c_1965798.jpeg "jboss (38).jpg")

- “Manage Event” allows the user to temporarily enable or disable each event in the event sheet from within the Administrative Console. To enable or disable an event, click the checkbox in the Enable/Disable column in the appropriate row. Clicking [Save] in the row of the event that has been enabled or disabled updates that event definition and saves the entire event sheet.

#### Figure B-13:    Manage Event
![Figure B-13:    Manage Event](https://gitee.com/uploads/images/2018/0605/144930_01073929_1965798.jpeg "jboss (39).jpg")

- “Refresh” updates the results displayed in the table using the most current information available.

> NOTE:
> The tables are not refreshed automatically.

- “Reload” updates the event sheet using any changes saved in Process Designer since the server was started. This button is disabled when failover is enabled.

> NOTE:
> If you delete or rename your currently running event sheet in Process Designer, clicking Refresh or Reload will not affect your event sheet’s performance. Event sheets are stored in Shop Operations Server’s cache. To clear the cache, you must stop and restart Shop Operations Server for your changes to take effect.

#### View Event History

The View Event History screen displays the following columns:

- Source: the source of the event

- Event: the name of the event

- Event time: the time the event was put into the processing queue

- Queue Time: the amount of time spent in the queue

- Processed time: the time the event started processing

- Processing time (sec.): the amount of time in seconds spent processing the event A large queue time indicates that the server is not keeping up with new events coming in.

A large processing time could indicate inefficiencies in the script code.

#### Figure B-14:    View Event History
![Figure B-14:    View Event History](https://gitee.com/uploads/images/2018/0605/144937_915c5b1f_1965798.jpeg "jboss (40).jpg")

#### View Event Chart View

Event Chart allows the user to view a variety of reports about the events being processed. The reports include:

- `Event Summary`: a bar chart of the count of events processed, separated according to event source. A large number of events of a particular source could be expected, or it could indicate that the volume is higher than anticipated.

Figure B-15:    View Event Chart
![Figure B-15:    View Event Chart](https://gitee.com/uploads/images/2018/0605/144945_d38eceff_1965798.jpeg "jboss (41).jpg")

- `Processing Time`: a pie chart of the total processing times by event source. A large portion of the pie indicates that this event source is consuming the majority of the available processing time compared to other events. This might be expected, or it could indicate inefficient script.

#### Figure B-16:    Processing Time Pie Chart
![Figure B-16:    Processing Time Pie Chart](https://gitee.com/uploads/images/2018/0605/144953_6a55ce4d_1965798.jpeg "jboss (42).jpg")

- `Composite`: shows a line chart for queue and processing times by event (new events are recorded on the right-hand side of the chart). A queue time that tends to increase over time indicates that the server is not keeping up with the volume of new events coming in. Large processing times could indicate inefficient script.

#### Figure B-17:    Composite Chart
![Figure B-17:    Composite Chart](https://gitee.com/uploads/images/2018/0605/145003_b180b47a_1965798.jpeg "jboss (43).jpg")

- “Refresh” redraws the charts using the most current information available.

## Viewing Logs

The Shop Operations Server administration console allows the user to view the following types of logs:

- Error/Informational Logs

- Println Outputs

- Application Logs

#### Viewing Error/Information Logs

The View Logs screen displays information about any informational or error entries logged. Each log entry includes the following information:

- an icon that indicates whether the entry is for an error or is informational only. Depending on the type of entry, one of the two following icons will be displayed:

  - – An informational entry will include a light bulb.

  - – An error entry will include a traffic warning sign.

- time the log entry was created.

- detailed information about the entry.

When the server is not executing script as expected, use the View Logs screen to see if any errors were logged that would indicate the root cause of the problem.

- [<<Oldest] shows the page with the oldest log entries.

- [<Older] shows the next page with older log entries.

- [Newer>] shows the next page with newer log entries.

- [Newest>>] shows the page with the newest log entries.

- [Refresh] rereads the log file from the disk.

An indicator of the current page’s relative position in the log file is displayed. For example, “20%” indicates that the current page is 20% of the way through all entries in the log file.

#### Figure B-18:    Error/Information Log
![Figure B-18:    Error/Information Log](https://gitee.com/uploads/images/2018/0605/145011_b213e218_1965798.jpeg "jboss (44).jpg")

#### Logging Debug Messages

If you want the Error/Information log to list debug messages as well, set the log level to FINE in the ShopOperationsServer.xml file located in the <`SOS_Install`>\bin folder. This level is set to INFO by default.

```
<log-level>INFO</log-level>
```

> NOTE:
> This setting also affects the Plant Operations Server and Client logs as well as any Foundation Server and Live Data entry in these logs.

If you no longer want the debug messages to appear in the Error/Information log, set the log level back to INFO or SEVERE.

It is also recommended that you increase the log file count to at least 10. The default is 4.

```
log-file-count="4"
```

#### Viewing Println Output

The View Println Output screen displays the output that has been scripted inside the event sheet (i.e., messages generated by the println() method). The most recent 500 println messages are stored and displayed with the oldest message being displayed first.

Click [Refresh] to fetch the latest data that Shop Operations Server has generated.  The console does not automatically refresh the screen after it is first displayed.

Click [Reset] to clear all previously collected data from Shop Operations Server. Restarting Shop Operations Server also clears all previously collected data.

#### Figure B-19:    View Println Output
![Figure B-19:    View Println Output](https://gitee.com/uploads/images/2018/0605/145018_65cfb369_1965798.jpeg "jboss (45).jpg")

#### Viewing Application Logs

The View Application Logs screen enables you to view a list of application log messages filtered by the Application object, date, and time. These messages are stored for 30 days by default and then purged.

An Application Log stores an application’s debugging messages. These messages are the application log items that are created and enabled in Process Designer using the Application object editor and then written to the Application Log using the `writeApplicationLogMessage` (`ApplicationLogItem`, `String`) method. Application log items are written to the Application Log if both of the following conditions are met:

- The application log item is enabled.

- If the application log item is a child of another application log item, the parent application log item is also enabled.

Please see the `Process Designer and Objects Help` for more information on creating and enabling application log items.

Application Logs are located at C:\.FTPC\<`serverHost`>\ProductionCentre\logs\ApplicationLog. The log for each client is only available on that specific client.

To view an Application Log:

1. Go to Logs > View Application Logs.

2. Select an Application object, a day, and a time period using the drop-down menus at the top of the screen. The application and its corresponding application log items for the selected objects display.

#### Figure B-20:    Set Filter Display
![Figure B-20:    Set Filter Display](https://gitee.com/uploads/images/2018/0605/145027_bd2d000e_1965798.jpeg "jboss2 (1).jpg")

3. Select the items you want displayed in the Application Log.

4. Click [View Logs] to display the Application Log. Use the [<] and [>] buttons to navigate through the log.

#### Figure B-21:    View Logs Display
![Figure B-21:    View Logs Display](https://gitee.com/uploads/images/2018/0605/145035_d9b0bee5_1965798.jpeg "jboss2 (2).jpg")

5. Click [Refresh] to redisplay the log after changing the filtering criteria or to display the most up-to-date messages. The console does not automatically refresh the screen after it is first displayed.

6. Click [Set Filter] to change the application log items displayed in the Application Log.

7. Click [Set Enable] to enable and disable application log items.

#### Figure B-22:    Set Enable Display
![Figure B-22:    Set Enable Display](https://gitee.com/uploads/images/2018/0605/145125_a92cf02f_1965798.jpeg "jboss2 (3).jpg")

8. Select the items you want enabled or disabled and then click [Save]. Your changes will be reflected in Process Designer after you have refreshed Process Designer.

#### Configuring Failover

Two Shop Operations Server instances running the same event sheet can be configured with master and slave roles to provide failover capability for the event sheet. The master and slave instances run as a two-instance cluster in an active-standby configuration with the two instances running on separate physical or virtual machines with unique IP addresses. Both instances must be identically configured with the same event sheet. Each instance runs only one event sheet.

Configuration for failover is performed using the Shop Operations Server administration console for each instance (`Figure B-4 on page 67`). The IP addresses or hostnames of the machines running the master and slave instances are explicitly entered together with a common port number. This configuration allows a TCP connection to be established between the master and slave instances. This connection is used to send messages between the master and slave instances to establish that each instance is performing its role as master or slave. The messages are sent between a default interval period of 500 milliseconds. This interval period is known as the `failover ping period`.

During startup, the master should be started before the slave. Thereafter, the slave must be started and running within 60,000 milliseconds (1 minute) of the startup of the master in order for the slave to be acknowledged. If the slave takes longer to start up and run, the master will start processing first. If the slave starts up later, it will join the running master in a cluster as the slave instance. This time period when the master waits for the slave to start up is known as the failover cluster timeout.

If the configured slave is started before the master, it will wait the duration of `failover cluster timeout` for the master to start. If the master is not started and running after failover cluster timeout has elapsed, the configured slave is promoted to be the master instance and starts processing its event sheet. Thereafter, if the configured master is started, it will detect that a master instance is already running and will demote itself to be the running slave instance.

The flowchart in `Figure B-23` describes the logic used by each Shop Operations Server instance when it starts up.

#### Figure B-23:    Startup logic for the master or slave Shop Operations Server instance
![Figure B-23:    Startup logic for the master or slave Shop Operations Server instance](https://gitee.com/uploads/images/2018/0605/145137_65511f90_1965798.jpeg "jboss2 (4).jpg")

To determine if the master instance has failed, the slave instance uses the consecutive occurrence of the following two criteria:

- when no message is received from the master after an interval period of 500 milliseconds (the `failover ping period`), and

- the last message received from the master is older than 3,000 milliseconds; this time value is known as the `failover connection timeout`.

> NOTE:
> If you need to change the default values of `failover ping period, failover cluster timeout`, or `failover connection timeout`, contact Rockwell support.

When these two criteria are met, the master is assumed to have failed. The slave instance is promoted to be the master instance and begins processing as the master. If the configured master is started up successfully later, it detects that an existing master is running and demotes itself to be the slave instance.

> NOTE:
> In order for the slave to promote itself to the master, it must verify that it can communicate with JBoss using port 7. Please make sure port 7 is not blocked.

To configure Shop Operations Server for failover, do the following for both the master and slave instances:

1. Open a browser and go to http://<`ShopOpsServer_name`>: <`jetty_port`>/ShopOperationsServer.

2. When the Shop Operations Server Login page (`Figure B-2`) appears, enter your username and password. The default login user/password is admin/admin.

3. When the administration console web page appears, in the left navigation pane, click [Configuration], then [Configure Server]. The server configuration settings web page (`Figure B-4`) appears.

4. To enable the current Shop Operations Server for failover, click the Failover check box.

5. In the MasterHost field, enter the IP address or hostname of the physical or virtual machine running the master Shop Operations Server instance.

6. In the SlaveHost field, enter the IP address or hostname of the physical or virtual machine running the slave Shop Operations Server instance.

> NOTE:
> Do not enter “localhost” in the MasterHost or SlaveHost field. Also, if you are using two VMware virtual machines for failover, one to run the master Shop Operations Server instance and one to run the slave Shop Operations Server instance, specify the IP address assigned to the VMware network adaptor of each virtual machine in the MasterHost or SlaveHost field.

7. In the Failover Port field, enter the port number that is used for master-slave communication. This value must be between 1025 to 65535. The default is 7700.

8. Click [Save] to save the changes you made.

9. Restart the Shop Operations Server.

10. Ensure that you enter identical settings for both the master and slave instances.

#### Limitations

When a connection failure occurs between the master and slave instances that does not involve failure of the master instance, such as a network connection failure, a scenario can occur where two master instances exist concurrently. For example, assume that the configured master and slave instances are running in their respective roles when a network connection failure occurs between them. During this network failure, the slave instance does not receive any messages from the master instance after the `failover ping period`, and the last message received from the master was older than the `failover connection timeout` value. The slave instance concludes that the master has failed, promotes itself to be the new master instance, and starts processing its event sheet. All this while, the configured master instance is still running but not communicating with the configured slave instance. When the network connection is recovers, two conflicting master instances exist.

When two master instances are detected, the system will restart the master node that has the shorter run cycle, and that node will become the slave node.

If there is a communication loss or a temporary promotion from slave to master, when network stability is restored, the longest-running node becomes the designated master.

#### Uninstalling Shop Operations Server

To uninstall the Shop Operations Server, run the UninstallApp-NT.bat script. This script uninstalls the Shop Operations Server Windows service. Once you have done that, back up your installation directory at <`ShopOpsServer_install`> and then delete it.

#### Upgrading Shop Operations Server

To upgrade FTPC, you must uninstall the old version and install the newest version of SOS. For directions on how to uninstall SOS refer to `“Uninstalling Shop Operations Server” on page 88`. Make sure that SOS is completely uninstalled before reinstalling the newest version. Refer to `“Installing Shop Operations Server” on page 60` for instructions on how to properly install SOS.

# Appendix C

# Troubleshooting

#### In this appendix

- `Viewing Available Log Files    90`
Server-Side Log Files    90
Client-Side Log Files    91
Consolidated Log    91
Application Log    92

- `Running FTPC Through a Proxy Server    94`

- `Running Java after Upgrading    95`

The following sections describe troubleshooting methods for FTPC issues you may encounter.

## Viewing Available Log Files If you encounter errors when running FTPC, refer to the log files listed in the following sections for information about the errors.

> NOTE:
> The rockwell_client_dir define controls where the log files are stored by SOS and <serverHost> is the name of the machine on which the client JAR files are downloaded. If you define rockwell_client_dir, the location of the log files will change. For more information on how to change the default location, please refer to `“Installing as a Windows Administrator” on page 60`.

#### Server-Side Log Files

Depending on the error messages you receive, refer to the log files saved on the application server machine in the following directories:

Table C-1 Server-Side Log File Locations

Category | Log File Location
-|-
Messages generated if you are running JBoss as a Windows service using the local system account | For Windows 2008 and 2012, the default location for this directory is: C:\Users\<`user_home`>\AppData\Roaming\ Rockwell Automation\FactoryTalk ProductionCentre\logs, where <`user_home`> is the home of the user that starts JBoss.
Errors related to migration and messages concerning initializing, migrating, and reorganizing databases using FTPC Administrator | For Windows 2008 and 2012, the default location for this directory is: C:\Users\<`user_home`>\AppData\Roaming\ Rockwell Automation\FactoryTalk ProductionCentre\logs\PlantOpsAdminServer\DsPlantOps AdminServer.html, where <`user_home`> is the home of the user that starts JBoss.
Errors related to middletier issues | For Windows 2008 and 2012, the default location for this directory is: C:\Users\<`user_home`>\AppData\Roaming\ Rockwell Automation\FactoryTalk ProductionCentre\Logs\PlantOpsServer\plantOpsServerLo g.html, where <`user_home`> is the home of the user that starts JBoss.
If you want to log debug messages as well, set the logging level to FINE. See `“Logging Debug Messages” on page 80` for details.

Once a log file reaches a certain size, the logging information is sent to a new log file, so multiple files may be present in these directories. To locate the most recent log file, look at the file with the latest timestamp and a name ending in .html.

#### Client-Side Log Files

If you receive FTPC errors while running the application as a client, look for the following folder:

```
C:\.FTPC\<serverHost>\ProductionCentre\logs\PlantOpsClient\PlantOpsClientL og.html
```

Once a log file reaches a certain size, the logging information is sent to a new log file, so multiple files may be present in this directory. To locate the most recent log file, look at the file with the latest timestamp and a name ending in .html.

If you want the PlantOpsClientLog.html file to log debug messages as well, set the logging level to FINE. See `“Logging Debug Messages” on page 80` for details.

#### Consolidated Log The CONSOLIDATED_LOG database table contains messages from the following clients:

- Shop Operations

- Shop Operations Server

- The Middletier

- Any WebServices client running through a proxy server (See `“Running FTPC Through a Proxy Server” on page 94` for details.)

Any messages that are currently logged to the PlantOpsClient log file should also be logged in the Consolidated Log. Using this centralized view of log messages across clients, you can isolate and investigate information logged based on specific criteria (for example, information from a particular Shop Operations Server client). Each entry captures both client and server times for the log message as well as other details (client type, client ID, severity level, etc.).

To enable logging to this log, do one of the following:

- Set the `consolidatedLoggingLevel` property in the SITE_CONFIG database table to 1.

#### Figure C-1:    Consolidated Log Configuration (SITE_CONFIG)
![Figure C-1:    Consolidated Log Configuration (SITE_CONFIG)](https://gitee.com/uploads/images/2018/0605/145144_36a43910_1965798.jpeg "jboss2 (5).jpg")

- In FTPC Administrator, check the `Consolidated Logging` property in the Database Logging section of the Database Configuration screen.

#### Figure C-2:    Consolidated Log Configuration (FTPC Administrator)
![Figure C-2:    Consolidated Log Configuration (FTPC Administrator)](https://gitee.com/uploads/images/2018/0605/145200_79ac41d5_1965798.jpeg "jboss2 (6).jpg")

You can view the log messages from the CONSOLIDATED_LOG database table and query for log messages based on specific client criteria using the FTPC Administrator. See the `FactoryTalk ProductionCentre Administrator User’s Guide` for details.

#### Application Log

An Application Log stores an application’s debugging messages. These messages are the application log items that are created and enabled in Process Designer using the Application object editor and then written to the Application Log using the `writeApplicationLogMessage (ApplicationLogItem, String)` method. Application log items are written to the Application Log if both of the following conditions are met:

- The application log item is enabled.

- If the application log item is a child of another application log item, the parent application log item is also enabled.

Please see the `Process Designer and Objects Help` for more information on creating and enabling application log items.

Application Logs are located at
C:\.FTPC\<`serverHost`>\ProductionCentre\logs\ApplicationLog. The log for each client is only available on that specific client.

You can configure the Application Log by defining the following properties in either the SITE_CONFIG database table or FTPC Administrator:

- `appLogRetentionPeriod (SITE_CONFIG)` or `Application Log Retention Period (FTPC Administrator)`: indicates the number of days the Application Log messages will be saved before they are deleted. The default is 30 days.

- `appLogRetentionRows (SITE_CONFIG)` or `Application Log` Maximum Size (FTPC Administrator): indicates the maximum number of rows that can be stored before the messages will be deleted. The default is 100,000 rows. Therefore, by default, only the latest 100,000 messages will be stored in descending order of insertion, and the rest are deleted.

#### Figure C-3:    Application Log Configuration (SITE_CONFIG)
![Figure C-3:    Application Log Configuration (SITE_CONFIG)](https://gitee.com/uploads/images/2018/0605/145212_d50eca32_1965798.jpeg "jboss2 (7).jpg")

#### Figure C-4:    Application Log Configuration (FTPC Administrator)
![Figure C-4:    Application Log Configuration (FTPC Administrator)](https://gitee.com/uploads/images/2018/0605/145218_749c8ed0_1965798.jpeg "jboss2 (8).jpg")

Messages will be deleted if either one of these criteria are met. For example, there are only 500 messages, but these messages have been saved in the database for 31 days. All the messages will be deleted because one of the criteria has been met.

You can also view this log in the Shop Operations Server administration console. This interface enables you to view a filtered list of application log messages.

See `“Viewing Application Logs” on page 81` for more details.

#### Running FTPC Through a Proxy Server

To set up the client machine for use with a proxy server, perform the following:

1. From the client machine’s main menu, go to Settings > Control Panel > Java.

2. Select the General tab, then click [Network Settings].

#### Figure C-5:    LAN Settings
![Figure C-5:    LAN Settings](https://gitee.com/uploads/images/2018/0605/145225_c4869505_1965798.jpeg "jboss2 (9).jpg")

3. Under Network Proxy Settings, check the Use browser settings radio button, then click [OK] and [OK] again to close out of the Java Control Panel dialog.

#### Figure C-6:    Proxy Server Pane
![Figure C-6:    Proxy Server Pane](https://gitee.com/uploads/images/2018/0605/145231_4dd87044_1965798.jpeg "jboss2 (10).jpg")

#### Running Java after Upgrading

When you uninstall a lower version of Java JDK or JRE and reset the JAVA_HOME, sometimes the command Java -version returns the lower Java version. To resolve this problem, you can do either of the following:

- When you run a Java command, specify the full path to the executable:

```
C:\j2sdk1.8.0_<version>\bin\java.exe DSDeployTools.jar ...
```

- To set the PATH permanently, add the full path of the j2sdk1.8.0_<`version`>\bin directory to the PATH variable where <`version`> is the installed Java build.

# Index
- A
API
return codes for the 54
Application Log 92
appLogRetentionPeriod 93
appLogRetentionRows 93
FTPC Administrator 93
audience 6

- C
concepts 5
Consolidated Log 91
consolidatedLoggingLevel 91
FTPC Administrator 91

- D
Database
SQL 34
SQL mirroring 35

- E
Event Sheets
Monitor 72
Using 70
expectations for user 6

- F
FactoryTalk ProductionCentre
installer 18
upgrade 39
FactoryTalk ProductionCentre applications
uninstall 40
FactoryTalk Security Provider 47
FTPC Administrator
application logging 93
consolidated logging 91

- G
Getting Started 5

- I
installer
FactoryTalk ProductionCentre 18
introduction 5

- J
Java runtime properties
setting 50
JMS Server URL 36

- L
language support 14
log files
Application Log 92
client side 91
Consolidated Log 91
server side 90
logins 8
Logs
application logs 81
debug messages 80
error/information logs 78
println output 80

- M
Message object
language support 14
Metal Look and Feel 26

- N
network connections 15
network protocol 15

- O
Organization 6
overview 5

- P
proxy server 94

- R
Read Me First 5
related documentation 7

- S
Shop Operations
failover support 58
Shop Operations HMI client
adding to an HMI display 51
audience and expectations 48
installing 48
uninstalling 55
upgrading 55
Shop Operations Server
administering 66
application logs 81
configuring 67
debug messagest 80
error/information logs 78
failover support 62
multiple instances 62
println output 80
SITE_CONFIG
appLogRetentionPeriod 93
appLogRetentionRows 93
consolidatedLoggingLevel 91
SQL database 34
mirroring 35
stop other applications 18
support 8

- T
TCP/IP 15
technical support 8
Third party 7
Troubleshooting 89

- U
upgrade
FactoryTalk ProductionCentre 39
preparing for 40
user logins 8
users
deleting or renaming 37

- V
Visual Basic API 53

- W
Windows 7 14
Windows Look and Feel 26
Windows Server 2008 14
Windows Server 2012 14
